import{j as e,R as B,A as X,C as Y,X as J,Y as Q,T as Z,a as ee}from"./vendor-ui-Csmkvd-_.js";import{d as te,r as m}from"./vendor-react-B11IQRCK.js";import{u as se,B as E,S as ae,C as re,T as oe,M as le}from"./index-jGGe8DBG.js";import{s as R}from"./insforgeClient-BTlHhBMi.js";const{useNavigate:ie}=te,b=({title:a,value:i,subtext:x,icon:v,color:h})=>e.jsxs("div",{className:"premium-card p-6 group hover:-translate-y-1 transition-all duration-300 shadow-sm relative overflow-hidden",children:[e.jsx("div",{className:`absolute top-4 right-4 p-3 rounded-2xl ${h} bg-opacity-10 text-opacity-100 transition-transform group-hover:scale-110`,children:e.jsx(v,{className:`w-5 h-5 ${h.replace("bg-","text-")}`})}),e.jsx("p",{className:"text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-[0.2em] mb-1.5",children:a}),e.jsx("h3",{className:"text-3xl font-black text-slate-800 dark:text-white tracking-tighter mb-2",children:i}),e.jsxs("p",{className:"text-[10px] font-bold text-slate-400 flex items-center gap-1.5 uppercase",children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${h}`})," ",x]})]}),ne=({user:a})=>{const i={online:"bg-emerald-500",busy:"bg-rose-500",away:"bg-amber-500",offline:"bg-slate-400"};return e.jsxs("div",{className:"flex flex-col items-center gap-2 min-w-[80px] p-2 rounded-2xl hover:bg-slate-50 dark:hover:bg-white/5 transition-all transition-colors cursor-pointer",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-gradient-to-br from-slate-50 to-slate-100 dark:from-white/10 dark:to-white/5 flex items-center justify-center text-slate-600 dark:text-white font-black text-sm border border-white dark:border-white/10 shadow-md",children:a.avatar}),e.jsx("div",{className:`absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-white dark:border-[#0b0b14] shadow-sm ${i[a.status]}`})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[10px] font-black text-slate-700 dark:text-slate-100 truncate max-w-[80px] leading-tight uppercase tracking-tight",children:a.name.split(" ")[0]}),e.jsx("p",{className:"text-[8px] font-bold text-slate-400 dark:text-slate-500 truncate max-w-[80px] uppercase tracking-widest",children:a.role})]})]})},ce=({activity:a,onClick:i})=>{const x={success:"bg-emerald-500/10 text-emerald-500 border-emerald-500/20",error:"bg-rose-500/10 text-rose-500 border-rose-500/20",warning:"bg-amber-500/10 text-amber-500 border-amber-500/20",info:"bg-blue-500/10 text-blue-500 border-blue-500/20"};return e.jsxs("div",{onClick:i,className:"flex gap-4 items-start p-3 rounded-xl hover:bg-slate-50 dark:hover:bg-white/5 transition-colors cursor-pointer group",children:[e.jsx("div",{className:`mt-1 min-w-[8px] h-2 rounded-full ${a.type==="success"?"bg-emerald-500":a.type==="error"?"bg-rose-500":"bg-blue-500"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-xs font-bold text-slate-800 dark:text-slate-200 truncate group-hover:text-[#5d5fef] transition-colors",children:[e.jsx("span",{className:"text-slate-500 dark:text-slate-400 font-normal",children:a.user})," ",a.action]}),e.jsx("p",{className:"text-[10px] text-slate-400 font-medium mt-0.5",children:a.time})]}),e.jsx("div",{className:`px-2 py-1 rounded text-[9px] font-black uppercase tracking-wider border ${x[a.type]}`,children:a.type})]})},he=({user:a})=>{const{theme:i}=se(),x=ie(),[v,h]=m.useState(!0),[o,I]=m.useState({ftq:0,ftqTrend:0,openNC:0,criticalNC:0,audits:0,efficiency:0}),[w,L]=m.useState([]),[k,M]=m.useState([]),[y,q]=m.useState([]);return m.useEffect(()=>{const l=async()=>{try{const{data:d,error:C}=await R.from("field_inspections").select("*").order("created_at",{ascending:!1}).limit(500);if(C)throw C;const{count:O,error:A}=await R.from("audits").select("*",{count:"exact",head:!0});if(A)throw A;const f=d?.filter(t=>{const s=new Date(t.created_at),r=new Date;return r.setDate(r.getDate()-7),s>=r})||[],W=f.filter(t=>t.estado==="Aprobado").length,S=f.length,z=S>0?W/S*100:100,F=2.4,H=d?.filter(t=>t.estado==="Rechazado").length||0,K=d?.filter(t=>t.estado==="Rechazado"&&(t.defecto?.toLowerCase().includes("critico")||t.defecto?.toLowerCase().includes("grave"))).length||0;let u=0,D=0;f.forEach(t=>{const s=parseFloat(t.cant_total)||0,r=parseFloat(t.cant_retenida)||0;u+=s,D+=r});const V=u>0?(u-D)/u*100:100;I({ftq:z,ftqTrend:F,openNC:H,criticalNC:K,audits:O||0,efficiency:V});const T=[],G=["Dom","Lun","Mar","Mie","Jue","Vie","Sab"],P=new Date;for(let t=6;t>=0;t--){const s=new Date;s.setDate(P.getDate()-t);const r=G[s.getDay()],n=f.filter(N=>{const $=new Date(N.created_at);return $.getDate()===s.getDate()&&$.getMonth()===s.getMonth()}),c=n.length,p=n.filter(N=>N.estado==="Aprobado").length,j=c>0?p/c*100:0;T.push({name:r,value:c>0?Math.round(j):t===6?95:90+Math.random()*10})}L(T);const U=(d||[]).filter(t=>{const s=!!t.reviso,r=(t.observacion||"").toLowerCase(),n=(t.observacion_sugerida||"").toLowerCase(),c=(t.estado||"").toLowerCase(),p=r.includes("reprocesar")||n.includes("reprocesar")||c==="reprocesar";return s&&p}).slice(0,5).map(t=>{let s="warning";t.estado==="Rechazado"&&(s="error");const r=`ReportÃ³: ${t.defecto||"Novedad"} (Lote ${t.op})`,n=new Date().getTime()-new Date(t.created_at).getTime(),c=Math.floor(n/6e4),p=Math.floor(c/60),j=p>0?`Hace ${p} horas`:`Hace ${c} min`;return{id:t.id,user:t.reviso||"Sistema",action:r,time:j,type:s,targetId:t.id}});M(U);const g=new Map;d?.forEach(t=>{const s=t.reviso;if(s&&!g.has(s)){const r=s.split(" "),n=r.length>1?`${r[0][0]}${r[1][0]}`:s.slice(0,2);g.set(s,{id:s,name:s,role:"Calidad",avatar:n.toUpperCase(),status:"online"})}}),q(Array.from(g.values()).slice(0,5))}catch(d){console.error("Dashboard Sync Error:",d)}finally{h(!1)}};l();const _=setInterval(l,3e4);return()=>clearInterval(_)},[]),e.jsxs("div",{className:"space-y-8 animate-fade-in pb-10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-end md:items-center gap-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl md:text-3xl font-black text-slate-900 dark:text-white tracking-tight",children:["Hola, ",e.jsx("span",{className:"text-[#5d5fef]",children:a.username.split(" ")[0]})," ðŸ‘‹"]}),e.jsx("p",{className:"text-sm text-slate-500 dark:text-slate-400 mt-1",children:"AquÃ­ tienes el resumen de operaciones de hoy."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"px-3 py-1 rounded-full bg-emerald-500/10 text-emerald-600 dark:text-emerald-400 text-xs font-bold border border-emerald-500/20 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-500 animate-pulse"})," Sistema Operativo"]}),e.jsxs("button",{className:"p-2 rounded-xl bg-white dark:bg-white/5 hover:bg-slate-50 dark:hover:bg-white/10 text-slate-400 transition-colors border border-slate-200 dark:border-white/5 relative",children:[e.jsx(E,{}),o.openNC>0&&e.jsx("span",{className:"absolute top-2 right-2 w-2 h-2 bg-rose-500 rounded-full border border-white dark:border-[#0f172a]"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsxs("div",{className:"lg:col-span-8 space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(b,{title:"FTQ Semanal",value:`${o.ftq.toFixed(1)}%`,subtext:`${o.ftqTrend>0?"+":""}${o.ftqTrend}% VS SEMANA ANT.`,icon:ae,color:"bg-emerald-500"}),e.jsx(b,{title:"NC Abiertas",value:String(o.openNC),subtext:o.criticalNC>0?`${o.criticalNC} CRÃTICA${o.criticalNC>1?"S":""} PENDIENTE${o.criticalNC>1?"S":""}`:"NO CRÃTICAS",icon:E,color:"bg-rose-500"}),e.jsx(b,{title:"AuditorÃ­as",value:String(o.audits),subtext:"Cumplimiento 100%",icon:re,color:"bg-blue-500"}),e.jsx(b,{title:"Eficiencia",value:`${o.efficiency.toFixed(0)}%`,subtext:"OEE PLANTA GENERAL",icon:oe,color:"bg-[#5d5fef]"})]}),e.jsxs("div",{className:"premium-card p-6 md:p-8 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-black text-slate-900 dark:text-white uppercase tracking-widest",children:"Rendimiento de Calidad"}),e.jsx("p",{className:"text-[10px] text-slate-400 font-bold uppercase tracking-wider mt-1",children:"Tendencia de los Ãºltimos 7 dÃ­as"})]}),e.jsx("select",{className:"bg-slate-50 dark:bg-white/5 border border-slate-200 dark:border-white/10 text-[10px] font-black uppercase tracking-widest rounded-xl px-4 py-2 text-slate-600 dark:text-slate-300 outline-none",children:e.jsx("option",{children:"Ãšltima Semana"})})]}),e.jsx("div",{className:"h-[300px] w-full",children:e.jsx(B,{width:"100%",height:"100%",children:e.jsxs(X,{data:w.length>0?w:le.qualityTrend,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorTrendMain",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#5d5fef",stopOpacity:.2}),e.jsx("stop",{offset:"95%",stopColor:"#5d5fef",stopOpacity:0})]})}),e.jsx(Y,{strokeDasharray:"3 3",vertical:!1,stroke:i==="dark"?"rgba(255,255,255,0.05)":"#e2e8f0"}),e.jsx(J,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fontSize:9,fill:"#94a3b8",fontWeight:"bold"},dy:10}),e.jsx(Q,{hide:!0,domain:[0,100]}),e.jsx(Z,{contentStyle:{backgroundColor:i==="dark"?"#0b0b14":"#fff",borderRadius:"16px",border:"1px solid rgba(255,255,255,0.1)",boxShadow:"0 20px 25px -5px rgba(0, 0, 0, 0.1)"},labelStyle:{color:"#94a3b8",fontSize:"9px",fontWeight:"bold",textTransform:"uppercase"}}),e.jsx(ee,{type:"monotone",dataKey:"value",stroke:"#5d5fef",strokeWidth:4,fill:"url(#colorTrendMain)",animationDuration:2e3})]})})})]})]}),e.jsxs("div",{className:"lg:col-span-4 space-y-8",children:[e.jsxs("div",{className:"premium-card p-6 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]",children:"Equipo en LÃ­nea"}),e.jsx("button",{className:"text-[#5d5fef] text-[10px] font-black uppercase tracking-widest hover:underline",children:"Ver Todos"})]}),e.jsx("div",{className:"flex gap-4 overflow-x-auto pb-4 no-scrollbar snap-x",children:y.length>0?y.map(l=>e.jsx("div",{className:"snap-start",children:e.jsx(ne,{user:l})},l.id)):e.jsx("p",{className:"text-xs text-slate-400 italic",children:"No hay inspectores activos hoy."})})]}),e.jsxs("div",{className:"premium-card p-6 shadow-sm flex-1",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h3",{className:"text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]",children:"Actividad Reciente"}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-[#5d5fef] animate-ping"})]}),e.jsx("div",{className:"space-y-2",children:k.length>0?k.map(l=>e.jsx(ce,{activity:l,onClick:()=>l.targetId&&x("/quality/forms",{state:{filterId:l.targetId}})},l.id)):e.jsx("p",{className:"text-xs text-slate-400 italic",children:"No hay actividad reciente."})}),e.jsx("button",{onClick:()=>x("/quality/forms"),className:"w-full mt-8 py-4 rounded-2xl border border-slate-200 dark:border-white/5 text-[10px] font-black uppercase tracking-widest text-slate-400 hover:bg-slate-50 dark:hover:bg-white/5 transition-all",children:"Ver Historial Completo"})]})]})]})]})};export{he as default};
