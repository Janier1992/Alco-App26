const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/aiService-DqBcYBBq.js","assets/vendor-core-L0lX3Z62.js"])))=>i.map(i=>d[i]);
import{a as C,$ as I,P as E,n as T,e as R,f as _,R as A,V as D,_ as S}from"./index-jGGe8DBG.js";import{j as e,M as O}from"./vendor-ui-Csmkvd-_.js";import{r as o}from"./vendor-react-B11IQRCK.js";import{B as G}from"./Breadcrumbs-D1gceSdN.js";import{s as p}from"./insforgeClient-BTlHhBMi.js";import{B as P}from"./BulkUploadButton-bSweF794.js";import"./vendor-core-L0lX3Z62.js";const U=()=>{const{addNotification:c}=C(),[m,y]=o.useState(""),[u,h]=o.useState(!1),[b,d]=o.useState("list"),[g,f]=o.useState([]),[N,j]=o.useState(!1),[s,l]=o.useState({docType:"Informe T√©cnico de Obra",client:"",project:"",subject:"",priority:"Media",status:"Recibido",description:"",assignedTo:"Ingenier√≠a Calidad"});o.useEffect(()=>{x()},[]);const x=async()=>{j(!0);try{const{data:t,error:r}=await p.from("quality_claims").select("*").order("created_at",{ascending:!1});if(r)throw r;const i=(t||[]).map(a=>({id:a.id,docType:a.claim_type,client:a.client_name,project:a.project_name,subject:a.subject||"",priority:a.priority||"Media",status:a.status||"Recibido",assignedTo:a.assigned_to||"Ingenier√≠a Calidad",date:new Date(a.created_at).toISOString().split("T")[0],description:a.description||"",officialContent:a.ai_analysis||""}));f(i)}catch(t){console.error("Error fetching claims:",t),c({type:"error",title:"Error",message:"No se pudieron cargar los reclamos."})}finally{j(!1)}},k=async()=>{if(!s.description)return c({type:"warning",title:"SIN CONTEXTO",message:"Describa el problema para redactar el informe."});h(!0);try{const{analyzeClaim:t}=await S(async()=>{const{analyzeClaim:a}=await import("./aiService-DqBcYBBq.js");return{analyzeClaim:a}},__vite__mapDeps([0,1])),r=await t(`
                Cliente: ${s.client}. 
                Proyecto: ${s.project}. 
                Asunto: ${s.docType}.
                Descripci√≥n: ${s.description}
            `);if(!r)throw new Error("No se pudo generar el an√°lisis.");const i=`
### ü§ñ An√°lisis de Inteligencia Artificial

**Clasificaci√≥n**: ${r.category||"General"}
**Severidad Detectada**: ${r.severity||"Media"}

---
### üìù Respuesta Sugerida
${r.suggestedResponse}

---
### ‚úÖ Pasos Recomendados
${r.actionItems?.map(a=>`- ${a}`).join(`
`)||"Revisar manual de calidad."}
            `;l(a=>({...a,officialContent:i,priority:r.severity||a.priority})),c({type:"success",title:"REDACCI√ìN IA COMPLETA",message:"Informe t√©cnico generado con √©xito."})}catch(t){console.error(t),c({type:"error",title:"FALLO T√âCNICO",message:"No se pudo conectar con los motores de redacci√≥n."})}finally{h(!1)}},v=async t=>{t.preventDefault();try{const r={claim_type:s.docType,client_name:s.client,project_name:s.project,subject:s.subject,priority:s.priority,status:s.status,description:s.description,ai_analysis:s.officialContent,assigned_to:s.assignedTo};let i;if(s.id){const{error:a}=await p.from("quality_claims").update(r).eq("id",s.id);i=a}else{const{error:a}=await p.from("quality_claims").insert(r);i=a}if(i)throw i;c({type:"success",title:"GESTI√ìN GUARDADA",message:"Registro actualizado en base de datos."}),s.id||d("list"),x()}catch(r){console.error("Save Error:",r),c({type:"error",title:"Error de Guardado",message:r.message||"Error desconocido al guardar."})}},w=async t=>{if(confirm("¬øEliminar esta gesti√≥n de reclamo?"))try{const{error:r}=await p.from("quality_claims").delete().eq("id",t);if(r)throw r;f(i=>i.filter(a=>a.id!==t)),c({type:"error",title:"ELIMINADO",message:"Registro purgado del sistema."})}catch(r){console.error(r),c({type:"error",title:"Error",message:"No se pudo eliminar el registro."})}},n="w-full p-4 bg-slate-50 dark:bg-slate-900 border-none rounded-2xl text-xs font-bold focus:ring-2 focus:ring-sky-500 outline-none transition-all uppercase";return e.jsxs("div",{className:"animate-fade-in space-y-8 pb-20",children:[e.jsx(G,{crumbs:[{label:"CALIDAD",path:"/dashboard"},{label:"GESTI√ìN DE RECLAMOS"}]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-black text-slate-800 dark:text-white uppercase tracking-tighter",children:["Gesti√≥n de ",e.jsx("span",{className:"text-sky-600",children:"Reclamos"})]}),e.jsxs("p",{className:"text-slate-500 font-bold mt-2 uppercase text-[10px] tracking-widest flex items-center gap-2",children:[e.jsx(I,{})," Automatizaci√≥n de Informes Post-Venta Alco"]})]}),b==="list"&&e.jsxs("div",{className:"flex gap-4",children:[e.jsx(P,{tableName:"quality_claims",onUploadComplete:x,label:"Importar Reclamos"}),e.jsxs("button",{onClick:()=>{l({docType:"Informe T√©cnico de Obra",client:"",project:"",description:"",status:"Recibido"}),d("editor")},className:"px-8 py-4 bg-sky-600 text-white rounded-2xl text-[11px] font-black uppercase tracking-widest shadow-xl hover:scale-105 flex items-center gap-2",children:[e.jsx(E,{})," Nueva Gesti√≥n"]})]})]}),b==="list"?e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-[3rem] shadow-xl border border-slate-100 dark:border-slate-700 overflow-hidden",children:[e.jsxs("div",{className:"p-8 border-b dark:border-slate-700 bg-slate-50 dark:bg-slate-900/50 flex justify-between items-center",children:[e.jsx("h3",{className:"text-xl font-black uppercase tracking-tighter",children:"Bit√°cora de Reclamaciones"}),e.jsx("input",{className:"px-4 py-2 border rounded-xl text-xs font-bold w-64 dark:bg-slate-900 outline-none",placeholder:"FILTRAR CLIENTE...",value:m,onChange:t=>y(t.target.value)})]}),e.jsx("div",{className:"overflow-x-auto",children:N?e.jsx("div",{className:"p-10 text-center text-slate-400",children:"Cargando reclamaciones..."}):e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"text-[10px] font-black uppercase text-slate-400 bg-slate-50/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-8 py-6",children:"ID / Documento"}),e.jsx("th",{className:"px-4 py-6",children:"Cliente / Obra"}),e.jsx("th",{className:"px-4 py-6 text-center",children:"Estado"}),e.jsx("th",{className:"px-8 py-6 text-right",children:"Acciones"})]})}),e.jsxs("tbody",{className:"divide-y dark:divide-slate-700",children:[g.filter(t=>t.client.toLowerCase().includes(m.toLowerCase())).map(t=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-white/5 transition-all",children:[e.jsxs("td",{className:"px-8 py-6",children:[e.jsxs("p",{className:"font-black text-xs uppercase text-slate-400",children:[t.id.substring(0,8),"..."]}),e.jsx("p",{className:"text-[9px] text-sky-600 uppercase font-bold",children:t.docType})]}),e.jsxs("td",{className:"px-4 py-6",children:[e.jsx("p",{className:"font-black text-xs uppercase dark:text-slate-200",children:t.client}),e.jsx("p",{className:"text-[9px] text-slate-400 uppercase font-bold",children:t.project})]}),e.jsx("td",{className:"px-4 py-6 text-center",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-[9px] font-black uppercase ${t.status==="Cerrado"?"bg-emerald-100 text-emerald-700":"bg-sky-100 text-sky-700"}`,children:t.status})}),e.jsxs("td",{className:"px-8 py-6 text-right flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>{l(t),d("editor")},className:"p-3 bg-sky-50 text-sky-600 rounded-xl hover:bg-sky-600 hover:text-white transition-all",children:e.jsx(T,{})}),e.jsx("button",{onClick:()=>w(t.id),className:"p-3 bg-rose-50 text-rose-500 rounded-xl hover:bg-rose-500 hover:text-white transition-all",children:e.jsx(R,{})})]})]},t.id)),g.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"p-8 text-center text-slate-400 font-bold text-xs uppercase",children:"No hay reclamos registrados"})})]})]})})]}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 animate-fade-in-up",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-800 p-10 rounded-[3.5rem] shadow-xl",children:[e.jsx("h2",{className:"text-2xl font-black uppercase mb-8 tracking-tighter dark:text-white",children:"Editor de Concepto T√©cnico"}),e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase block mb-2",children:"Tipo de Comunicaci√≥n"}),e.jsxs("select",{className:n,value:s.docType,onChange:t=>l({...s,docType:t.target.value}),children:[e.jsx("option",{children:"Informe T√©cnico de Obra"}),e.jsx("option",{children:"Comunicado Oficial Post-Venta"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase block mb-2",children:"Cliente"}),e.jsx("input",{required:!0,className:n,value:s.client,onChange:t=>l({...s,client:t.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase block mb-2",children:"Obra / Proyecto"}),e.jsx("input",{required:!0,className:n,value:s.project,onChange:t=>l({...s,project:t.target.value})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase block mb-2",children:"Estado"}),e.jsxs("select",{className:n,value:s.status,onChange:t=>l({...s,status:t.target.value}),children:[e.jsx("option",{children:"Recibido"}),e.jsx("option",{children:"En An√°lisis"}),e.jsx("option",{children:"En Ejecuci√≥n"}),e.jsx("option",{children:"Cerrado"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase block mb-2",children:"Prioridad"}),e.jsxs("select",{className:n,value:s.priority,onChange:t=>l({...s,priority:t.target.value}),children:[e.jsx("option",{children:"Baja"}),e.jsx("option",{children:"Media"}),e.jsx("option",{children:"Alta"}),e.jsx("option",{children:"Cr√≠tica"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black text-slate-400 uppercase block mb-2",children:"Relato del Hallazgo"}),e.jsx("textarea",{required:!0,rows:5,className:`${n} normal-case`,value:s.description,onChange:t=>l({...s,description:t.target.value}),placeholder:"Describa la discusi√≥n t√©cnica aqu√≠..."})]}),e.jsxs("div",{className:"flex gap-4 pt-4 border-t dark:border-slate-700",children:[e.jsx("button",{type:"button",onClick:()=>d("list"),className:"flex-1 py-5 bg-slate-100 dark:bg-slate-700 text-slate-500 dark:text-slate-300 rounded-3xl font-black text-xs uppercase hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-[2] py-5 bg-emerald-600 text-white rounded-3xl font-black text-xs uppercase shadow-xl hover:bg-emerald-700 transition-colors",children:"Guardar en Registro"})]})]})]}),e.jsxs("div",{className:"bg-slate-900 rounded-[3.5rem] p-10 flex flex-col shadow-2xl overflow-hidden min-h-[600px]",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("h3",{className:"text-xl font-black text-white uppercase tracking-tighter flex items-center gap-3",children:[e.jsx(_,{className:"text-sky-400"})," Redacci√≥n Automatizada"]}),e.jsxs("button",{onClick:k,disabled:u,className:"px-6 py-3 bg-sky-600 text-white rounded-2xl text-[10px] font-black uppercase flex items-center gap-2 hover:bg-sky-700 transition-all disabled:opacity-50",children:[u?e.jsx(A,{className:"animate-spin"}):e.jsx("i",{className:"fas fa-magic"})," Generar Concepto Pro"]})]}),e.jsx("div",{className:"flex-grow bg-white/5 border border-white/10 rounded-[2.5rem] p-8 overflow-y-auto prose prose-invert prose-sm",children:s.officialContent?e.jsx(O,{children:s.officialContent}):e.jsxs("div",{className:"h-full flex flex-col items-center justify-center opacity-20",children:[e.jsx(D,{className:"text-6xl mb-4"}),e.jsx("p",{className:"text-xs font-black uppercase tracking-widest text-center",children:"Haga clic en 'Generar Concepto Pro' para redactar el informe t√©cnico basado en su relato."})]})})]})]})]})};export{U as default};
