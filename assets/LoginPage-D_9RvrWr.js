import{j as e}from"./vendor-ui-Csmkvd-_.js";import{r as a}from"./vendor-react-B11IQRCK.js";import{s as x}from"./insforgeClient-BTlHhBMi.js";const I=({onLogin:f})=>{const[s,w]=a.useState("login"),[n,v]=a.useState(""),[d,j]=a.useState(""),[c,N]=a.useState(""),[h,u]=a.useState(!1),[o,b]=a.useState(null);a.useEffect(()=>{console.log("Listening for beforeinstallprompt");const r=t=>{console.log("beforeinstallprompt fired",t),t.preventDefault(),b(t)};return window.addEventListener("beforeinstallprompt",r),()=>window.removeEventListener("beforeinstallprompt",r)},[]);const[g,m]=a.useState(""),k=async r=>{r.preventDefault(),m(""),u(!0);try{if(s==="login"){const{data:t,error:l}=await x.auth.signInWithPassword({email:n,password:d});if(l)throw l;if(t.user){const{data:i,error:p}=await x.from("profiles").select("*").eq("id",t.user.id).single();p&&p.code!=="PGRST116"&&console.error("Profile fetch error:",p);const S={id:t.user.id,email:t.user.email||"",username:i?.full_name||t.user.email?.split("@")[0]||"Usuario",role:i?.role||"user"};f(S)}}else{const{data:t,error:l}=await x.auth.signUp({email:n,password:d,options:{data:{full_name:c}}});if(l)throw l;if(t.user&&t.session){const i={id:t.user.id,email:t.user.email||"",username:c,role:"user"};f(i)}else if(t.user&&!t.session){m("Registro exitoso. Por favor revisa tu correo para confirmar tu cuenta antes de iniciar sesión."),u(!1);return}}}catch(t){m(t.message||"Ocurrió un error al autenticar.")}finally{u(!1)}},y=async()=>{if(!o)return;o.prompt();const{outcome:r}=await o.userChoice;r==="accepted"&&b(null)};return e.jsxs("div",{className:"min-h-screen w-full bg-[#0a0f1d] text-slate-200 flex items-center justify-center p-4 selection:bg-emerald-500/30 font-sans relative overflow-hidden",children:[e.jsxs("div",{className:"absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none",children:[e.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-emerald-500/5 blur-[100px] rounded-full"}),e.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[40%] h-[40%] bg-indigo-500/5 blur-[100px] rounded-full"})]}),o&&e.jsxs("button",{onClick:y,className:"absolute top-6 right-6 flex items-center gap-2 px-4 py-2 bg-emerald-500/10 hover:bg-emerald-500/20 text-emerald-400 rounded-full border border-emerald-500/20 transition-all font-bold text-xs uppercase tracking-wider z-50 animate-fade-in",children:[e.jsx("i",{className:"fas fa-download"}),"Instalar App"]}),e.jsxs("div",{className:"bg-[#12172a] border border-white/10 p-8 md:p-12 rounded-[2.5rem] shadow-2xl w-full max-w-md animate-fade-in-up relative overflow-hidden z-10",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-emerald-500/5 blur-3xl rounded-full"}),e.jsxs("div",{className:"mb-8 text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-tr from-emerald-500 to-sky-500 rounded-xl flex items-center justify-center shadow-lg shadow-emerald-500/20 mx-auto mb-4",children:e.jsx("i",{className:"fas fa-layer-group text-slate-900 text-lg"})}),e.jsxs("h2",{className:"text-2xl font-black text-white uppercase tracking-tighter mb-4",children:["Calidad ",e.jsx("span",{className:"text-emerald-400",children:"Proyectos"})]}),e.jsx("p",{className:"text-slate-400 text-sm font-medium mb-6 leading-relaxed px-4",children:"Simplifica el camino hacia la calidad total. Gestiona auditorías, documentos y no conformidades en una sola plataforma centralizada."}),e.jsx("p",{className:"text-slate-500 text-xs font-bold uppercase tracking-widest",children:s==="login"?"Iniciar Sesión":"Crear Cuenta"})]}),g&&e.jsx("div",{className:"mb-6 p-4 bg-rose-500/10 border border-rose-500/20 text-rose-400 rounded-xl text-xs font-bold text-center uppercase tracking-wider animate-shake",children:g}),e.jsxs("form",{onSubmit:k,className:"space-y-4 relative z-10",children:[s==="register"&&e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1.5 text-[10px] font-black uppercase text-slate-500 tracking-widest px-1",children:"Nombre Operativo"}),e.jsx("input",{type:"text",value:c,onChange:r=>N(r.target.value),required:!0,className:"w-full px-5 py-3 bg-white/5 border border-white/10 rounded-xl text-white outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500 transition-all placeholder:text-slate-700 text-sm",placeholder:"Nombre completo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1.5 text-[10px] font-black uppercase text-slate-500 tracking-widest px-1",children:"Email Corporativo"}),e.jsx("input",{type:"email",value:n,onChange:r=>v(r.target.value),required:!0,className:"w-full px-5 py-3 bg-white/5 border border-white/10 rounded-xl text-white outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500 transition-all placeholder:text-slate-700 text-sm",placeholder:"email@alco.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-1.5 text-[10px] font-black uppercase text-slate-500 tracking-widest px-1",children:"Contraseña"}),e.jsx("input",{type:"password",value:d,onChange:r=>j(r.target.value),required:!0,className:"w-full px-5 py-3 bg-white/5 border border-white/10 rounded-xl text-white outline-none focus:ring-2 focus:ring-emerald-500/50 focus:border-emerald-500 transition-all placeholder:text-slate-700 text-sm",placeholder:"••••••••"})]}),e.jsx("button",{type:"submit",disabled:h,className:"w-full py-4 bg-gradient-to-r from-emerald-600 to-emerald-500 text-slate-950 font-black rounded-xl shadow-lg shadow-emerald-500/20 mt-2 hover:scale-[1.02] active:scale-95 transition-all uppercase tracking-widest text-xs disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Procesando...":s==="login"?"Ingresar a Suite":"Registrarse"})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsx("button",{onClick:()=>w(s==="login"?"register":"login"),className:"text-slate-500 text-xs font-bold hover:text-emerald-400 transition-colors",children:s==="login"?"¿No tienes cuenta? Regístrate":"¿Ya tienes cuenta? Inicia Sesión"})})]})]})};export{I as default};
