import{j as e}from"./vendor-ui-Csmkvd-_.js";import{r as h}from"./vendor-react-B11IQRCK.js";import{B as H}from"./Breadcrumbs-D1gceSdN.js";import{s as v}from"./insforgeClient-BTlHhBMi.js";import{a as Q,x as q,K as $,C as L,N as V,P,U as X,g as Y,c as J,Q as Z}from"./index-CRB8BTUJ.js";const N={async getBoardByType(t){const{data:a,error:s}=await v.from("boards").select("id").eq("type",t).order("created_at",{ascending:!1});if(s)throw s;return a?.[0]},async getColumnsByBoardId(t){const{data:a,error:s}=await v.from("board_columns").select("*").eq("board_id",t).order("position");if(s)throw s;return a||[]},async createDefaultColumns(t,a){const s=[];for(let o=0;o<a.length;o++){const{data:n,error:b}=await v.from("board_columns").insert({board_id:t,title:a[o],position:o}).select().single();if(b)throw b;n&&s.push(n)}return s},async getTasksWithDetails(t){const{data:a,error:s}=await v.from("board_tasks").select(`
                *,
                labels:task_labels(*),
                assignedUsers:task_assignees(*),
                checklist:task_checklists(*),
                attachments:task_attachments(*),
                comments:task_comments(*)
            `).in("column_id",t).order("position");if(s)throw s;return a||[]},async createTask(t){const{data:a,error:s}=await v.from("board_tasks").insert({board_id:t.boardId,column_id:t.columnId,title:t.title,priority:t.priority,description:t.description,position:t.position,due_date:t.dueDate}).select().single();if(s)throw s;return a},async updateTask(t,a){const{data:s,error:o}=await v.from("board_tasks").update(a).eq("id",t).select().single();if(o)throw o;return s},async addLabel(t,a,s){const{data:o,error:n}=await v.from("task_labels").insert({task_id:t,name:a,color:s}).select().single();if(n)throw n;return o},async removeLabel(t,a){const{error:s}=await v.from("task_labels").delete().eq("task_id",t).eq("name",a);if(s)throw s},async addAssignee(t,a,s){const{data:o,error:n}=await v.from("task_assignees").insert({task_id:t,user_id:a,user_initials:s}).select().single();if(n)throw n;return o},async removeAssignee(t,a){const{error:s}=await v.from("task_assignees").delete().eq("task_id",t).eq("user_id",a);if(s)throw s},async uploadAttachment(t,a){const{error:s}=await v.storage.from("project-attachments").upload(a,t);if(s)throw s;const{data:o}=v.storage.from("project-attachments").getPublicUrl(a);return o.publicUrl},async createAttachmentRecord(t){const{data:a,error:s}=await v.from("task_attachments").insert({task_id:t.taskId,name:t.name,url:t.url,type:t.type,size:t.size}).select().single();if(s)throw s;return a},async moveTask(t,a,s){const{error:o}=await v.from("board_tasks").update({column_id:a,position:s}).eq("id",t);if(o)throw o}},ee=(t="projects")=>{const[a,s]=h.useState({}),[o,n]=h.useState(!0),[b,j]=h.useState(null),[u,C]=h.useState(null),{addNotification:f}=Q(),p=h.useCallback(async()=>{try{n(!0);let r=b;if(!r){const d=await N.getBoardByType(t);if(d)r=d.id,j(r);else{f({type:"warning",title:"Tablero no encontrado",message:`No se encontró un tablero de tipo ${t}`}),n(!1);return}}if(!r)return;let l=await N.getColumnsByBoardId(r);l.length===0&&(l=await N.createDefaultColumns(r,["Pendiente","En Proceso","Completado"]));const m=l.map(d=>d.id),c=await N.getTasksWithDetails(m),x={};l.forEach(d=>{x[d.id]={id:d.id,title:d.title,tasks:[]}}),c.forEach(d=>{x[d.column_id]&&x[d.column_id].tasks.push({id:d.id,title:d.title,description:d.description||"",priority:d.priority,dueDate:d.due_date,labels:d.labels||[],assignedUsers:d.assignedUsers?.map(g=>({id:g.user_id||g.id,initials:g.user_initials||"??"}))||[],checklist:d.checklist||[],attachments:d.attachments||[],comments:d.comments?.map(g=>({id:g.id,author:g.author_name||"Desconocido",text:g.content,date:new Date(g.created_at).toLocaleDateString()}))||[],assetId:d.asset_id,type:d.maintenance_type,column_id:d.column_id})}),s(x)}catch(r){console.error(r),f({type:"error",title:"Error de Datos",message:r.message})}finally{n(!1)}},[t,b,f]);h.useEffect(()=>{p()},[p]);const y=r=>{const l={...a};Object.keys(l).forEach(m=>{const c=[...l[m].tasks],x=c.findIndex(d=>d.id===r.id);x!==-1&&(c[x]=r,l[m]={...l[m],tasks:c})}),s(l),u?.id===r.id&&C(r)};return{columns:a,loading:o,selectedTask:u,setSelectedTask:C,createTask:async(r,l,m,c)=>{if(b)try{const x=await N.createTask({boardId:b,columnId:r,title:l,priority:m,description:c,position:a[r].tasks.length,dueDate:new Date().toISOString().split("T")[0]}),d={id:x.id,title:x.title,priority:x.priority,description:x.description,dueDate:x.due_date,labels:[],assignedUsers:[],attachments:[],checklist:[],column_id:r},g={...a};g[r].tasks.push(d),s(g),f({type:"success",title:"Tarea Creada",message:`"${l}" ha sido agregada.`})}catch(x){f({type:"error",title:"Error",message:x.message})}},toggleLabel:async(r,l)=>{const m=r.labels.find(c=>c.name===l.name);try{if(m){await N.removeLabel(r.id,l.name);const c={...r,labels:r.labels.filter(x=>x.name!==l.name)};y(c)}else{const c=await N.addLabel(r.id,l.name,l.color),x={...r,labels:[...r.labels,c]};y(x)}}catch(c){f({type:"error",title:"Error",message:c.message})}},toggleMember:async(r,l)=>{const m=r.assignedUsers.find(c=>c.id===l.id);try{if(m){await N.removeAssignee(r.id,l.id);const c={...r,assignedUsers:r.assignedUsers.filter(x=>x.id!==l.id)};y(c)}else{await N.addAssignee(r.id,l.id,l.initials);const c={...r,assignedUsers:[...r.assignedUsers,l]};y(c)}}catch(c){f({type:"error",title:"Error de Asignación",message:c.message})}},moveTask:async(r,l,m)=>{if(l===m)return;const c=a[l];a[m];const x=c.tasks.findIndex(E=>E.id===r),d=c.tasks[x],g={...a};g[l].tasks.splice(x,1),g[m].tasks.push(d),s(g);try{await N.moveTask(r,m,g[m].tasks.length-1)}catch(E){f({type:"error",title:"Error al mover",message:E.message}),p()}},updateTaskFields:async(r,l)=>{try{const m={};l.title&&(m.title=l.title),l.description&&(m.description=l.description),l.priority&&(m.priority=l.priority),l.dueDate&&(m.due_date=l.dueDate);const c=await N.updateTask(r,m);if(u&&u.id===r){const x={...u,...l};y(x)}}catch(m){f({type:"error",title:"Error",message:m.message})}},uploadAttachment:async(r,l,m)=>{try{f({type:"info",title:"Subiendo...",message:"El archivo se está guardando."});const c=await N.uploadAttachment(l,m),x=await N.createAttachmentRecord({taskId:r,name:m,url:c,type:l.type,size:l.size});if(u){const d={...u,attachments:[...u.attachments||[],x]};y(d)}f({type:"success",title:"Éxito",message:"Archivo adjuntado."})}catch(c){f({type:"error",title:"Error de carga",message:c.message})}},refresh:p}},te=({task:t,columnId:a,onClick:s,onDragStart:o})=>e.jsxs("div",{draggable:!0,onDragStart:n=>o(n,t.id,a),onClick:s,className:"bg-white dark:bg-[#1a1a24] rounded-xl p-3 shadow-sm border border-slate-200 dark:border-white/5 hover:border-sky-500/50 dark:hover:border-sky-500/30 transition-all group cursor-pointer mb-3",children:[e.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:t.labels?.map(n=>e.jsx("div",{className:"px-2 py-0.5 rounded-md text-[8px] font-black uppercase tracking-wider text-white shadow-sm flex items-center gap-1",style:{backgroundColor:n.color==="red"?"#ef4444":n.color==="blue"?"#0ea5e9":"#f59e0b"},children:n.name},n.id))}),e.jsxs("div",{className:"flex justify-between items-start mb-2 gap-2",children:[e.jsx("h3",{className:"text-[13px] font-bold text-slate-700 dark:text-slate-200 leading-snug group-hover:text-sky-500 transition-colors flex-1",children:t.title}),e.jsxs("div",{className:"flex -space-x-2 shrink-0 pt-0.5 ml-auto",children:[t.assignedUsers?.slice(0,3).map(n=>e.jsx("div",{className:"size-6 rounded-full bg-sky-100 dark:bg-sky-500/20 border-2 border-white dark:border-[#1a1a24] flex items-center justify-center text-[10px] font-black text-sky-600 dark:text-sky-300 shadow-md",title:n.initials,children:n.initials},n.id)),t.assignedUsers&&t.assignedUsers.length>3&&e.jsxs("div",{className:"size-6 rounded-full bg-slate-100 dark:bg-white/10 border-2 border-white dark:border-[#1a1a24] flex items-center justify-center text-[9px] font-bold text-slate-400 shadow-sm",children:["+",t.assignedUsers.length-3]})]})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex flex-col gap-1.5",children:[t.dueDate&&e.jsxs("div",{className:`flex items-center gap-1 text-[10px] font-black px-2 py-0.5 rounded-md ${new Date(t.dueDate)<new Date?"bg-rose-50 text-rose-500 dark:bg-rose-900/20":"bg-slate-100 text-slate-500 dark:bg-white/5"}`,children:[e.jsx(q,{className:"scale-75"})," ",new Date(t.dueDate).toLocaleDateString("es-ES",{day:"numeric",month:"short"})]}),e.jsxs("div",{className:"flex gap-2 text-slate-400",children:[t.attachments?.length>0&&e.jsxs("span",{className:"text-[10px] font-bold flex items-center gap-1",children:[e.jsx($,{className:"scale-75"})," ",t.attachments.length]}),t.checklist&&t.checklist.length>0&&e.jsxs("span",{className:"text-[10px] font-bold flex items-center gap-1",children:[e.jsx(L,{className:"scale-75"})," ",t.checklist.filter(n=>n.completed).length,"/",t.checklist.length]})]})]})})]}),se=({isOpen:t,onClose:a,onCapture:s})=>{const o=h.useRef(null),n=h.useRef(null);h.useEffect(()=>(t&&(async()=>{try{const u=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});n.current=u,o.current&&(o.current.srcObject=u)}catch(u){console.error("Error accessing camera:",u),alert("No se pudo acceder a la cámara. Asegúrese de haber otorgado los permisos necesarios."),a()}})(),()=>{n.current&&(n.current.getTracks().forEach(u=>u.stop()),n.current=null)}),[t,a]);const b=()=>{const j=o.current;if(j){const u=document.createElement("canvas");u.width=j.videoWidth,u.height=j.videoHeight;const C=u.getContext("2d");C&&(C.drawImage(j,0,0,u.width,u.height),s(u.toDataURL("image/jpeg")),a())}};return t?e.jsxs("div",{className:"fixed inset-0 z-[3000] bg-black flex flex-col items-center justify-center",children:[e.jsx("video",{ref:o,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsxs("div",{className:"absolute bottom-10 flex gap-10 items-center",children:[e.jsx("button",{onClick:a,className:"size-16 rounded-full bg-white/20 backdrop-blur-md flex items-center justify-center text-white font-bold",children:"×"}),e.jsx("button",{onClick:b,className:"size-24 rounded-full border-8 border-white bg-transparent"}),e.jsx("div",{className:"size-16"})," "]})]}):null},O=({title:t,onClose:a,anchorEl:s,children:o})=>{const n=h.useRef(null);return h.useEffect(()=>{const b=j=>{n.current&&!n.current.contains(j.target)&&s.current&&!s.current.contains(j.target)&&a()};return document.addEventListener("mousedown",b),()=>document.removeEventListener("mousedown",b)},[a,s]),s.current?e.jsxs("div",{ref:n,className:"absolute z-[2500] w-72 bg-white dark:bg-[#1a1a24] shadow-2xl rounded-2xl border border-slate-200 dark:border-white/10 p-4 animate-fade-in mt-2 right-0 md:left-0 md:right-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 border-b dark:border-white/5 pb-2",children:[e.jsx("span",{className:"text-[10px] font-black uppercase text-slate-400 tracking-widest",children:t}),e.jsx("button",{onClick:a,className:"text-slate-400 hover:text-rose-500",children:"×"})]}),o]}):null},ae=({task:t,onClose:a,onUpdateTaskFields:s,onToggleLabel:o,onToggleMember:n,onUploadAttachment:b,currentColumnTitle:j,availableLabels:u,registroUsers:C})=>{const[f,p]=h.useState(!1),[y,z]=h.useState(t.title),[S,_]=h.useState(!1),[I,k]=h.useState(t.description||""),[w,r]=h.useState(""),[l,m]=h.useState(""),[c,x]=h.useState(null),[d,g]=h.useState(!1),E=h.useRef(null),R={labels:h.useRef(null),members:h.useRef(null),dates:h.useRef(null)},F=async()=>{y.trim()&&(await s(t.id,{title:y}),p(!1))},G=async()=>{await s(t.id,{description:I}),_(!1)},W=i=>{const T=t.checklist?.map(D=>D.id===i?{...D,completed:!D.completed}:D);s(t.id,{checklist:T})},B=()=>{if(!w.trim())return;const i={id:Date.now().toString(),text:w,completed:!1},T=[...t.checklist||[],i];s(t.id,{checklist:T}),r("")},K=async i=>{const D=await(await fetch(i)).blob(),A=`capture_${Date.now()}.jpg`;await b(t.id,D,A)};return e.jsx("div",{className:"fixed inset-0 z-[2000] bg-slate-900/90 backdrop-blur-sm flex items-center justify-center p-4 md:p-8",onClick:a,children:e.jsxs("div",{className:"w-full max-w-4xl max-h-[90vh] bg-white dark:bg-[#1a1a24] rounded-3xl shadow-2xl p-6 md:p-10 overflow-y-auto animate-fade-in border border-slate-200 dark:border-white/5",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-start mb-8",children:[e.jsxs("div",{className:"flex-1 mr-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("span",{className:"px-3 py-1 bg-sky-100 dark:bg-sky-900/30 text-sky-700 dark:text-sky-300 rounded-full text-[10px] font-black uppercase tracking-wider",children:j}),t.dueDate&&e.jsxs("span",{className:"flex items-center gap-1 text-[10px] uppercase font-bold text-slate-400",children:[e.jsx(q,{className:"size-3"})," Due ",t.dueDate]})]}),e.jsx("div",{className:"flex items-center gap-6 mb-2",children:f?e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx("input",{className:"flex-1 text-3xl font-black bg-slate-50 dark:bg-black/20 border border-sky-500/50 rounded-xl px-4 py-2 outline-none text-slate-900 dark:text-white",value:y,onChange:i=>z(i.target.value),autoFocus:!0}),e.jsx("button",{onClick:F,className:"px-6 bg-sky-600 text-white rounded-xl text-xs font-black uppercase tracking-widest hover:brightness-110 active:scale-95 transition-all",children:"Guardar"}),e.jsx("button",{onClick:()=>p(!1),className:"px-6 bg-slate-100 dark:bg-white/5 text-slate-500 rounded-xl text-xs font-black uppercase tracking-widest hover:bg-slate-200 dark:hover:bg-white/10 transition-all",children:"X"})]}):e.jsxs(e.Fragment,{children:[e.jsx("h2",{className:"text-3xl font-black text-slate-900 dark:text-white leading-tight cursor-pointer hover:text-sky-500 transition-colors",onClick:()=>p(!0),children:t.title}),e.jsx("div",{className:"flex -space-x-2",children:t.assignedUsers?.map(i=>e.jsx("div",{className:"size-8 rounded-full bg-sky-100 dark:bg-sky-500/20 border-2 border-white dark:border-[#1a1a24] flex items-center justify-center text-[10px] font-black text-sky-600 dark:text-sky-300 shadow-lg",title:i.initials,children:i.initials},i.id))})]})}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:t.labels?.map(i=>e.jsx("div",{className:"px-3 py-1 rounded-xl text-[10px] font-black uppercase tracking-widest text-white shadow-lg shadow-black/10 border border-white/10",style:{backgroundColor:i.color==="red"?"#ef4444":i.color==="blue"?"#0ea5e9":"#f59e0b"},children:i.name},i.id))})]}),e.jsx("button",{onClick:a,className:"size-10 bg-slate-100 dark:bg-white/5 rounded-full flex items-center justify-center text-slate-500 hover:text-slate-800 transition-colors",children:"×"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-10",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-10",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-sm font-black text-slate-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(V,{})," Descripción Técnica"]}),!S&&e.jsx("button",{onClick:()=>_(!0),className:"text-xs font-bold text-sky-600 hover:text-sky-500 transition-colors",children:"Editar"})]}),S?e.jsxs("div",{className:"space-y-3",children:[e.jsx("textarea",{className:"w-full p-4 bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl min-h-[150px] text-sm text-slate-700 dark:text-slate-300 focus:ring-2 focus:ring-sky-500/50 outline-none resize-none",value:I,onChange:i=>k(i.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:G,className:"px-4 py-2 bg-sky-600 text-white rounded-lg text-xs font-bold uppercase tracking-wider",children:"Guardar"}),e.jsx("button",{onClick:()=>_(!1),className:"px-4 py-2 bg-slate-200 dark:bg-white/5 text-slate-600 dark:text-slate-400 rounded-lg text-xs font-bold uppercase tracking-wider",children:"Cancelar"})]})]}):e.jsx("div",{onClick:()=>_(!0),className:"prose prose-sm dark:prose-invert text-slate-600 dark:text-slate-300 cursor-pointer p-4 hover:bg-slate-50 dark:hover:bg-white/5 rounded-xl transition-colors border border-transparent hover:border-slate-200 dark:hover:border-white/10",children:t.description||e.jsx("span",{className:"italic opacity-50",children:"Sin descripción detallada..."})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-black text-slate-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx(L,{})," Checklist de Calidad"]}),e.jsxs("div",{className:"space-y-2",children:[t.checklist&&t.checklist.length>0&&e.jsx("div",{className:"h-2 bg-slate-100 dark:bg-white/5 rounded-full overflow-hidden mb-4",children:e.jsx("div",{className:"h-full bg-sky-500 transition-all duration-500",style:{width:`${t.checklist.filter(i=>i.completed).length/t.checklist.length*100}%`}})}),t.checklist?.map(i=>e.jsxs("div",{className:"group flex items-center gap-3 p-3 bg-slate-50 dark:bg-white/[0.02] rounded-xl hover:bg-white dark:hover:bg-white/5 border border-transparent hover:border-sky-500/20 transition-all",children:[e.jsx("input",{type:"checkbox",checked:i.completed,onChange:()=>W(i.id),className:"size-5 rounded border-slate-300 text-sky-600 focus:ring-sky-500 cursor-pointer"}),e.jsx("span",{className:`text-sm font-medium ${i.completed?"line-through text-slate-400":"text-slate-700 dark:text-slate-300"}`,children:i.text})]},i.id)),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("input",{className:"flex-1 bg-transparent border-b border-slate-200 dark:border-white/10 py-2 text-sm focus:border-sky-500 outline-none transition-colors",placeholder:"Añadir ítem...",value:w,onChange:i=>r(i.target.value),onKeyDown:i=>i.key==="Enter"&&B()}),e.jsx("button",{onClick:B,className:"text-slate-400 hover:text-sky-500",children:e.jsx(P,{})})]})]})]})]}),e.jsx("div",{className:"space-y-8",children:e.jsxs("div",{children:[e.jsx("h4",{className:"text-[10px] font-black uppercase text-slate-400 tracking-widest mb-4",children:"Acciones"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("button",{ref:R.labels,onClick:()=>x("labels"),className:"relative flex items-center gap-2 px-4 py-3 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 dark:hover:bg-white/10 rounded-xl text-xs font-bold text-slate-600 dark:text-slate-300 transition-all text-left",children:[e.jsx("span",{className:"size-4 rounded bg-emerald-400"})," Etiquetas"]}),c==="labels"&&e.jsx(O,{title:"Etiquetas",onClose:()=>x(null),anchorEl:R.labels,children:e.jsx("div",{className:"space-y-2",children:u.map(i=>e.jsx("button",{onClick:()=>o(t,i),className:`w-full p-2 rounded-lg text-left text-[10px] font-black uppercase flex items-center justify-between transition-all ${t.labels?.find(T=>T.name===i.name)?"ring-2 ring-sky-500 ring-offset-2":""}`,style:{backgroundColor:i.color==="red"?"#ef444422":i.color==="blue"?"#0ea5e922":"#f59e0b22",color:i.color==="red"?"#ef4444":i.color==="blue"?"#0ea5e9":"#f59e0b"},children:i.name},i.id))})}),e.jsxs("button",{ref:R.members,onClick:()=>x("members"),className:"relative flex items-center gap-2 px-4 py-3 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 dark:hover:bg-white/10 rounded-xl text-xs font-bold text-slate-600 dark:text-slate-300 transition-all text-left",children:[e.jsx(X,{className:"size-4"})," Miembros"]}),c==="members"&&e.jsx(O,{title:"Miembros de Calidad",onClose:()=>x(null),anchorEl:R.members,children:e.jsx("div",{className:"space-y-1 max-h-60 overflow-y-auto custom-scrollbar",children:C.map((i,T)=>{const D=i.split(" ").map(U=>U[0]).join("").substring(0,2),A=`reg_${T}`,M=t.assignedUsers?.some(U=>U.id===A);return e.jsxs("button",{onClick:()=>n(t,{id:A,initials:D}),className:`w-full p-2.5 rounded-lg text-left text-[11px] font-bold flex items-center gap-3 hover:bg-slate-100 dark:hover:bg-white/5 transition-all ${M?"text-sky-600 bg-sky-50/50 dark:bg-sky-500/10":"text-slate-500"}`,children:[e.jsx("div",{className:"size-7 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center text-[10px] font-black",children:D}),e.jsx("span",{className:"flex-1 truncate",children:i}),M&&e.jsx(L,{className:"size-3.5"})]},A)})})}),e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-4 py-3 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 dark:hover:bg-white/10 rounded-xl text-xs font-bold text-slate-600 dark:text-slate-300 transition-all text-left",children:[e.jsx(Y,{className:"size-4"})," Tomar Foto"]}),e.jsxs("button",{onClick:()=>E.current?.click(),className:"flex items-center gap-2 px-4 py-3 bg-slate-100 dark:bg-white/5 hover:bg-slate-200 dark:hover:bg-white/10 rounded-xl text-xs font-bold text-slate-600 dark:text-slate-300 transition-all text-left",children:[e.jsx($,{className:"size-4"})," Adjuntar Archivo"]}),e.jsx("input",{type:"file",ref:E,className:"hidden",onChange:i=>{const T=i.target.files?.[0];T&&b(t.id,T,T.name)}})]})]})})]}),e.jsx(se,{isOpen:d,onClose:()=>g(!1),onCapture:K})]})})},re=({isOpen:t,onClose:a,onCreate:s})=>{const[o,n]=h.useState(""),[b,j]=h.useState("Media"),[u,C]=h.useState(""),f=async p=>{p.preventDefault(),o.trim()&&(await s(o,b,u),n(""),C(""),a())};return t?e.jsx("div",{className:"fixed inset-0 z-[2000] bg-slate-900/90 backdrop-blur-sm flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-lg bg-white dark:bg-[#1a1a24] rounded-3xl shadow-2xl p-8 border border-slate-200 dark:border-white/5 animate-fade-in",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-black text-slate-900 dark:text-white uppercase tracking-widest",children:"Nuevo Requerimiento"}),e.jsx("button",{onClick:a,className:"text-slate-400 hover:text-rose-500",children:"×"})]}),e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2",children:"Título de la Tarea"}),e.jsx("input",{className:"w-full p-4 bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl outline-none focus:ring-2 focus:ring-sky-500/50 text-sm",placeholder:"Nombre corto y descriptivo...",value:o,onChange:p=>n(p.target.value),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2",children:"Prioridad"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:["Baja","Media","Alta","Crítica"].map(p=>e.jsx("button",{type:"button",onClick:()=>j(p),className:`py-2 rounded-lg text-[10px] font-black uppercase transition-all ${b===p?"bg-sky-600 text-white":"bg-slate-100 dark:bg-white/5 text-slate-400"}`,children:p},p))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2",children:"Descripción"}),e.jsx("textarea",{className:"w-full p-4 bg-slate-50 dark:bg-black/20 border border-slate-200 dark:border-white/10 rounded-xl outline-none focus:ring-2 focus:ring-sky-500/50 text-sm min-h-[100px] resize-none",placeholder:"Detalles adicionales...",value:u,onChange:p=>C(p.target.value)})]}),e.jsx("button",{type:"submit",className:"w-full py-4 bg-sky-600 text-white rounded-xl font-black uppercase tracking-widest shadow-xl shadow-sky-600/20 hover:brightness-110 active:scale-[0.98] transition-all",children:"Crear Requerimiento"})]})]})}):null},de=()=>{const{columns:t,loading:a,selectedTask:s,setSelectedTask:o,createTask:n,toggleLabel:b,toggleMember:j,moveTask:u,updateTaskFields:C,uploadAttachment:f}=ee("projects"),[p,y]=h.useState(!1),[z,S]=h.useState(null),_=(k,w,r)=>{k.dataTransfer.setData("taskId",w),k.dataTransfer.setData("sourceColId",r)},I=(k,w)=>{const r=k.dataTransfer.getData("taskId"),l=k.dataTransfer.getData("sourceColId");u(r,l,w)};return a?e.jsx("div",{className:"flex-1 flex items-center justify-center bg-slate-50 dark:bg-[#0f0f1a]",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"size-12 border-4 border-sky-500/20 border-t-sky-500 rounded-full animate-spin"}),e.jsx("p",{className:"text-xs font-black text-slate-400 uppercase tracking-widest",children:"Sincronizando Tablero..."})]})}):e.jsxs("div",{className:"flex-1 overflow-x-auto bg-slate-50 dark:bg-[#0f0f1a]",children:[e.jsxs("div",{className:"p-4 md:p-8 flex justify-between items-center sticky left-0",children:[e.jsx(H,{crumbs:[{label:"OPERACIONES",path:"/ops"},{label:"GESTIÓN PROYECTOS",path:"/ops/projects"}]}),e.jsxs("button",{onClick:()=>{S(Object.keys(t)[0]),y(!0)},className:"flex items-center gap-2 px-6 py-3 bg-sky-600 text-white rounded-2xl text-xs font-black uppercase tracking-widest shadow-xl shadow-sky-600/20 hover:brightness-110 active:scale-95 transition-all",children:[e.jsx(P,{className:"size-4"})," Nuevo Requerimiento"]})]}),e.jsx("div",{className:"px-4 md:px-8 pb-10 flex gap-6 min-w-max h-[calc(100vh-140px)]",children:Object.values(t).map(k=>e.jsxs("div",{onDragOver:w=>w.preventDefault(),onDrop:w=>I(w,k.id),className:"w-80 flex flex-col h-full rounded-3xl bg-slate-200/40 dark:bg-white/[0.03] p-4 border border-slate-200 dark:border-white/5",children:[e.jsx("div",{className:"flex items-center justify-between mb-6 px-2",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h3",{className:"text-xs font-black text-slate-500 dark:text-slate-400 uppercase tracking-widest",children:k.title}),e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-white dark:bg-white/5 text-[10px] font-bold text-slate-400",children:k.tasks.length})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar space-y-3",children:[k.tasks.map(w=>e.jsx(te,{task:w,columnId:k.id,onDragStart:_,onClick:()=>o(w)},w.id)),e.jsxs("button",{onClick:()=>{S(k.id),y(!0)},className:"w-full flex items-center gap-2 p-3 text-slate-500 hover:bg-slate-200 dark:hover:bg-white/10 rounded-xl transition-all group border border-dashed border-slate-300 dark:border-white/10",children:[e.jsx(P,{className:"size-4 group-hover:text-sky-500"}),e.jsx("span",{className:"text-xs font-bold group-hover:text-sky-500 transition-colors",children:"Añada una tarjeta"})]})]})]},k.id))}),s&&e.jsx(ae,{task:s,onClose:()=>o(null),onUpdateTaskFields:C,onToggleLabel:b,onToggleMember:j,onUploadAttachment:f,currentColumnTitle:t[s.column_id||""]?.title||"Tarea",availableLabels:Z,registroUsers:J}),e.jsx(re,{isOpen:p,onClose:()=>y(!1),onCreate:(k,w,r)=>n(z,k,w,r)})]})};export{de as default};
