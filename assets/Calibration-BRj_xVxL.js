import{j as e}from"./vendor-ui-Csmkvd-_.js";import{r as c}from"./vendor-react-B11IQRCK.js";import{B as I}from"./Breadcrumbs-D1gceSdN.js";import{a as E,P as R,l as D,C as S,m as O,n as A,r as _}from"./index-jGGe8DBG.js";import{s as u}from"./insforgeClient-BTlHhBMi.js";const q=()=>{const{addNotification:n}=E(),[x,m]=c.useState(!1),[p,N]=c.useState(""),[d,h]=c.useState(null),[y,b]=c.useState(!0),[k,g]=c.useState([]),f=async()=>{b(!0);try{const{data:t,error:s}=await u.from("metrology_calibration").select("*").order("due_date",{ascending:!0});if(s)throw s;const r=(t||[]).map(l=>({id:l.id,tool:l.tool_name,code:l.tool_code,lastDate:l.last_date,dueDate:l.due_date,status:l.status,certificateNumber:l.certificate_number}));g(r)}catch(t){console.error("Error fetching calibration records:",t),n({type:"error",title:"ERROR DE CARGA",message:"No se pudo recuperar la programación de calibración."})}finally{b(!1)}};c.useEffect(()=>{f()},[]);const[a,o]=c.useState({tool:"",code:"",lastDate:"",dueDate:"",status:"Vigente",certificateNumber:""}),v=t=>{h(t.id);const{id:s,...r}=t;o(r),m(!0)},w=async t=>{if(confirm("¿Eliminar permanentemente este registro de calibración?"))try{const{error:s}=await u.from("metrology_calibration").delete().eq("id",t);if(s)throw s;g(r=>r.filter(l=>l.id!==t)),n({type:"error",title:"EQUIPO ELIMINADO",message:"El instrumento ha sido removido del cronograma oficial."})}catch{n({type:"error",title:"ERROR",message:"No se pudo eliminar el equipo."})}},C=async t=>{t.preventDefault();try{const s={tool_name:a.tool,tool_code:a.code,last_date:a.lastDate,due_date:a.dueDate,status:a.status,certificate_number:a.certificateNumber};let r;if(d?r=await u.from("metrology_calibration").update(s).eq("id",d):r=await u.from("metrology_calibration").insert([s]),r.error)throw r.error;n({type:"success",title:d?"REGISTRO ACTUALIZADO":"EQUIPO REGISTRADO",message:d?"Información técnica corregida.":"Nuevo instrumento incorporado al control SGC."}),f(),m(!1),h(null),o({tool:"",code:"",lastDate:"",dueDate:"",status:"Vigente",certificateNumber:""})}catch(s){console.error("Error saving calibration:",s),n({type:"error",title:"ERROR",message:s.message})}},j=k.filter(t=>t.tool.toLowerCase().includes(p.toLowerCase())||t.code.toLowerCase().includes(p.toLowerCase())),i="w-full p-4 bg-slate-50 dark:bg-slate-800 border-none rounded-2xl text-xs font-bold focus:ring-2 focus:ring-sky-500 outline-none uppercase transition-all";return e.jsxs("div",{className:"animate-fade-in space-y-8 pb-20",children:[e.jsx(I,{crumbs:[{label:"METROLOGÍA",path:"/metrology"},{label:"CALIBRACIÓN"}]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-black text-slate-800 dark:text-white uppercase tracking-tighter",children:["Control de ",e.jsx("span",{className:"text-sky-600",children:"Calibración"})]}),e.jsx("p",{className:"text-slate-500 font-bold uppercase text-[10px] tracking-widest italic",children:"Aseguramiento de la validez de los resultados (ISO 9001 7.1.5)"})]}),e.jsx("button",{onClick:()=>m(!x),className:`px-8 py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-xl flex items-center gap-2 transition-all ${x?"bg-rose-500 text-white":"bg-sky-600 text-white hover:scale-105 shadow-sky-600/20"}`,children:x?"Cerrar Panel":e.jsxs(e.Fragment,{children:[e.jsx(R,{})," Vincular Instrumento"]})})]}),x&&e.jsx("div",{className:"bg-white dark:bg-slate-900 p-10 rounded-[3rem] shadow-2xl animate-fade-in-up border border-sky-500/20",children:e.jsxs("form",{onSubmit:C,className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-slate-400 mb-2 block ml-1",children:"Nombre Técnico del Instrumento"}),e.jsx("input",{required:!0,value:a.tool,onChange:t=>o({...a,tool:t.target.value}),className:i,placeholder:"Ej: Calibrador Digital Mitutoyo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-slate-400 mb-2 block ml-1",children:"Código Interno"}),e.jsx("input",{required:!0,value:a.code,onChange:t=>o({...a,code:t.target.value}),className:i,placeholder:"Ej: MET-088"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-slate-400 mb-2 block ml-1",children:"Última Intervención"}),e.jsx("input",{type:"date",value:a.lastDate,onChange:t=>o({...a,lastDate:t.target.value}),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-slate-400 mb-2 block ml-1",children:"Vencimiento del Certificado"}),e.jsx("input",{type:"date",value:a.dueDate,onChange:t=>o({...a,dueDate:t.target.value}),className:i})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-slate-400 mb-2 block ml-1",children:"Número de Certificado"}),e.jsx("input",{required:!0,value:a.certificateNumber,onChange:t=>o({...a,certificateNumber:t.target.value}),className:i,placeholder:"Ej: 88219"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] font-black uppercase text-slate-400 mb-2 block ml-1",children:"Estado de Vigencia"}),e.jsxs("select",{value:a.status,onChange:t=>o({...a,status:t.target.value}),className:i,children:[e.jsx("option",{children:"Vigente"}),e.jsx("option",{children:"Vencido"}),e.jsx("option",{children:"Próximo"}),e.jsx("option",{children:"Mantenimiento"})]})]})]}),e.jsxs("button",{type:"submit",className:"w-full py-5 bg-sky-600 text-white rounded-3xl font-black text-xs uppercase tracking-widest shadow-xl shadow-sky-600/20 active:scale-95 transition-all",children:[e.jsx(D,{})," ",d?"Actualizar Ficha Técnica":"Incorporar al Cronograma Maestro"]})]})}),e.jsxs("div",{className:"bg-white dark:bg-slate-800 rounded-[3rem] border shadow-xl overflow-hidden border-slate-100 dark:border-slate-700",children:[e.jsxs("div",{className:"p-8 border-b dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900/50",children:[e.jsxs("h3",{className:"text-xl font-black uppercase tracking-tighter flex items-center gap-3",children:[e.jsx(S,{className:"text-sky-600"})," Cronograma de Calibración Planta Alco"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"px-10 py-2 bg-white dark:bg-slate-800 border dark:border-slate-700 rounded-xl text-xs font-bold w-64 outline-none focus:ring-2 focus:ring-sky-500",placeholder:"BUSCAR INSTRUMENTO...",value:p,onChange:t=>N(t.target.value)}),e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"text-[10px] font-black uppercase text-slate-400 bg-slate-50/50 dark:bg-slate-900/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-8 py-6",children:"Instrumento / Modelo"}),e.jsx("th",{className:"px-4 py-6",children:"Código Alco"}),e.jsx("th",{className:"px-4 py-6",children:"Certificado"}),e.jsx("th",{className:"px-4 py-6 text-center",children:"Estatus ISO"}),e.jsx("th",{className:"px-8 py-6 text-right",children:"Gestión"})]})}),e.jsx("tbody",{className:"divide-y dark:divide-slate-700",children:y?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-8 py-20 text-center text-xs font-black uppercase animate-pulse",children:"Consultando base de datos oficial..."})}):j.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-8 py-20 text-center opacity-30 text-xs font-black uppercase",children:"Sin equipos registrados en el sistema de metrología"})}):j.map(t=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-white/5 transition-all group",children:[e.jsx("td",{className:"px-8 py-6 font-black text-xs uppercase text-slate-700 dark:text-slate-100",children:t.tool}),e.jsx("td",{className:"px-4 py-6 font-mono text-xs text-sky-600 font-bold bg-sky-50 dark:bg-sky-900/20",children:t.code}),e.jsxs("td",{className:"px-4 py-6 text-xs font-bold text-slate-500",children:["#",t.certificateNumber]}),e.jsx("td",{className:"px-4 py-6 text-center",children:e.jsx("span",{className:`px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest ${t.status==="Vigente"?"bg-emerald-100 text-emerald-700":"bg-rose-100 text-rose-700"}`,children:t.status})}),e.jsxs("td",{className:"px-8 py-6 text-right flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>v(t),className:"p-3 bg-sky-50 text-sky-600 rounded-xl hover:bg-sky-600 hover:text-white transition-all shadow-sm",children:e.jsx(A,{})}),e.jsx("button",{onClick:()=>w(t.id),className:"p-3 bg-rose-50 text-rose-500 rounded-xl hover:bg-rose-500 hover:text-white transition-all shadow-sm",children:e.jsx(_,{})})]})]},t.id))})]})})]})]})};export{q as default};
