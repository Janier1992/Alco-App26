import{j as e}from"./vendor-ui-Csmkvd-_.js";import{r as l}from"./vendor-react-B11IQRCK.js";import{r as z,u as C}from"./vendor-core-L0lX3Z62.js";import{s as L}from"./insforgeClient-BTlHhBMi.js";import{a as X,R as $,a0 as R,X as G,d as q,l as K}from"./index-K6Oge8P9.js";const ee=({tableName:A,onUploadComplete:S,label:O="Carga Masiva (Excel)",mapping:j,columns:o})=>{const{addNotification:x}=X(),r=l.useRef(null),[h,n]=l.useState(!1),[m,P]=l.useState([]),[I,D]=l.useState([]),[U,i]=l.useState(!1),T=async a=>{const s=a.target.files?.[0];if(!s)return;n(!0);const t=new FileReader;t.onload=async p=>{try{const d=p.target?.result,k=z(d,{type:"binary"}),V=k.SheetNames[0],v=k.Sheets[V],b=C.sheet_to_json(v,{header:1});if(b.length===0)throw new Error("El archivo está vacío.");const B=["FECHA","DATE","OP","ORDEN","AREA","PROCESO","PLANO","ITEM","TOTAL","CANTIDAD","ESTADO","STATUS"];let f=0,u=0;for(let c=0;c<Math.min(b.length,10);c++){const w=b[c];if(!w||w.length===0)continue;const N=w.filter(E=>typeof E=="string"&&B.some(_=>E.toUpperCase().includes(_))).length;N>u&&(u=N,f=c)}console.log(`Header found at row ${f} with ${u} matches.`);const g=C.sheet_to_json(v,{range:f}),H=Object.keys(g[0]);D(H);const y=j?g.map(j):g;P(y.slice(0,5));const M=y;window.tempUploadPayload=M,i(!0)}catch(d){console.error("Read Error:",d),x({type:"error",title:"ERROR DE LECTURA",message:d.message||"Error al leer el archivo."}),r.current&&(r.current.value="")}finally{n(!1)}},t.readAsBinaryString(s)},F=async()=>{const a=window.tempUploadPayload;if(a){n(!0);try{const{error:s}=await L.from(A).insert(a);if(s)throw s;x({type:"success",title:"CARGA EXITOSA",message:`Se importaron ${a.length} registros.`}),S(),i(!1)}catch(s){console.error("Upload Error:",s),x({type:"error",title:"ERROR DE CARGA",message:s.message||"Error al insertar en base de datos."})}finally{n(!1),r.current&&(r.current.value=""),window.tempUploadPayload=null}}};return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",accept:".xlsx, .xls, .csv",ref:r,onChange:T,className:"hidden"}),e.jsxs("button",{onClick:()=>r.current?.click(),disabled:h,className:"flex items-center gap-2 px-4 py-2.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-bold text-xs shadow-md transition-all active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",children:[h?e.jsx($,{className:"animate-spin"}):e.jsx(R,{}),h?"Procesando...":O]}),U&&e.jsx("div",{className:"fixed inset-0 z-[9999] bg-slate-900/80 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"bg-white dark:bg-[#1a1b26] w-full max-w-4xl rounded-2xl shadow-2xl border border-slate-200 dark:border-white/10 overflow-hidden flex flex-col max-h-[90vh]",children:[e.jsxs("div",{className:"p-6 border-b border-slate-100 dark:border-white/5 flex justify-between items-center bg-slate-50/50 dark:bg-white/5",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-black text-slate-800 dark:text-white uppercase tracking-tight flex items-center gap-2",children:[e.jsx(R,{className:"text-emerald-500"})," Vista Previa de Carga"]}),e.jsxs("p",{className:"text-xs text-slate-500 dark:text-slate-400 mt-1",children:["Encabezados detectados: ",e.jsx("span",{className:"font-mono bg-slate-100 dark:bg-black/30 px-1 rounded text-emerald-600",children:I.join(", ")})]})]}),e.jsx("button",{onClick:()=>i(!1),className:"p-2 hover:bg-rose-100 dark:hover:bg-rose-900/20 text-slate-400 hover:text-rose-600 rounded-lg transition-all",children:e.jsx(G,{className:"scale-125"})})]}),e.jsxs("div",{className:"p-6 overflow-auto bg-slate-50 dark:bg-[#0b0b14]",children:[e.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 mb-4",children:"Primeros 5 registros procesados"}),e.jsx("div",{className:"overflow-x-auto rounded-xl border border-slate-200 dark:border-white/5 shadow-sm",children:e.jsxs("table",{className:"w-full text-xs text-left",children:[e.jsx("thead",{className:"bg-slate-100 dark:bg-white/5 text-slate-500 dark:text-slate-400 font-bold uppercase",children:e.jsx("tr",{children:o?o.map(a=>e.jsx("th",{className:"px-4 py-3 whitespace-nowrap",children:a.label},a.key)):m.length>0&&Object.keys(m[0]).map(a=>e.jsx("th",{className:"px-4 py-3 whitespace-nowrap",children:a},a))})}),e.jsx("tbody",{className:"divide-y divide-slate-100 dark:divide-white/5 bg-white dark:bg-[#1a1b26]",children:m.map((a,s)=>e.jsx("tr",{className:"hover:bg-slate-50 dark:hover:bg-white/5 transition-colors",children:o?o.map(t=>e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-slate-700 dark:text-slate-300",children:a[t.key]===null||a[t.key]===""?e.jsx("span",{className:"text-rose-500 font-bold italic",children:"VACÍO"}):String(a[t.key])},t.key)):Object.values(a).map((t,p)=>e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-slate-700 dark:text-slate-300",children:t===null||t===""?e.jsx("span",{className:"text-rose-500 font-bold italic",children:"VACÍO"}):String(t)},p))},s))})]})}),e.jsxs("div",{className:"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-xl border border-blue-100 dark:border-blue-900/30 flex items-start gap-3",children:[e.jsx("div",{className:"text-blue-500 mt-0.5",children:e.jsx(q,{})}),e.jsxs("p",{className:"text-xs text-blue-700 dark:text-blue-300 leading-relaxed",children:["**Verifica los datos:** Si ves campos marcados como ",e.jsx("span",{className:"text-rose-500 font-bold",children:"VACÍO"})," en columnas críticas (OP, Area, Fecha), revisa que los encabezados de tu Excel coincidan o sean sinónimos reconocibles."]})]})]}),e.jsxs("div",{className:"p-6 border-t border-slate-100 dark:border-white/5 bg-slate-50/50 dark:bg-white/5 flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>i(!1),className:"px-6 py-2.5 text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-white font-bold text-xs uppercase tracking-widest transition-colors",children:"Cancelar"}),e.jsxs("button",{onClick:F,className:"px-6 py-2.5 bg-emerald-600 hover:bg-emerald-700 text-white rounded-xl font-bold text-xs uppercase tracking-widest shadow-lg shadow-emerald-900/20 active:scale-95 transition-all flex items-center gap-2",children:[e.jsx(K,{})," Confirmar e Importar"]})]})]})})]})};export{ee as B};
