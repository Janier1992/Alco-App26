const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/aiService-DqBcYBBq.js","assets/vendor-core-L0lX3Z62.js"])))=>i.map(i=>d[i]);
import{a as se,w as te,P as H,m as ae,R as S,v as O,e as C,o as re,d as le,f as _,h as ie,g as ce,I as oe,s as ne,U as de,x as xe,l as q,A as pe,_ as me}from"./index-jGGe8DBG.js";import{j as e,M as he}from"./vendor-ui-Csmkvd-_.js";import{r as n,e as D}from"./vendor-react-B11IQRCK.js";import{B as ue}from"./Breadcrumbs-D1gceSdN.js";import{s as d}from"./insforgeClient-BTlHhBMi.js";const we=()=>{const{addNotification:c}=se(),[j,B]=n.useState([]),[L,T]=n.useState(!0),[r,A]=n.useState(null),[F,I]=n.useState(!1),[V,N]=n.useState(!1),[z,M]=n.useState(!1),[b,J]=n.useState(""),[o,w]=n.useState(1),g=10,[k,P]=n.useState(""),[R,$]=n.useState(""),[E,Z]=n.useState("Correctiva"),U=D.useRef(null);n.useEffect(()=>{x()},[]);const x=async()=>{T(!0);try{const{data:s,error:t}=await d.from("non_conformities").select(`
                    *,
                    nc_actions (*),
                    nc_history (*)
                `).order("created_at",{ascending:!1});if(t)throw t;const a=s.map(l=>({id:l.serial_id||l.id,db_id:l.id,title:l.title,process:l.process,project:l.project,severity:l.severity,status:l.status,description:l.description,rca:l.rca,actions:l.nc_actions.map(i=>({id:i.id,description:i.description,responsible:i.responsible,dueDate:i.due_date,completed:i.completed})),createdAt:l.created_at.split("T")[0],closedAt:l.closed_at,history:l.nc_history.map(i=>({id:i.id,date:new Date(i.created_at).toLocaleString(),user:"USUARIO",action:i.action,details:i.details}))}));B(a)}catch(s){c({type:"error",title:"ERROR DE CARGA",message:s.message})}finally{T(!1)}},p=D.useMemo(()=>{if(!b)return j;const s=b.toLowerCase();return j.filter(t=>t.title.toLowerCase().includes(s)||t.id.toLowerCase().includes(s)||t.process.toLowerCase().includes(s)||t.project.toLowerCase().includes(s))},[j,b]),y=D.useMemo(()=>{const s=(o-1)*g;return p.slice(s,s+g)},[p,o]),m=Math.ceil(p.length/g);n.useEffect(()=>{w(1)},[b]);const K=async s=>{s.preventDefault();const t=new FormData(s.currentTarget),a=`NC-25-${(j.length+1).toString().padStart(3,"0")}`,l={serial_id:a,title:t.get("title").toUpperCase(),process:t.get("process"),project:t.get("project"),severity:t.get("severity"),description:t.get("description"),status:"Abierta",rca:{why1:"",why2:"",why3:"",why4:"",why5:"",rootCause:""}};try{const{data:i,error:v}=await d.from("non_conformities").insert([l]).select().single();if(v)throw v;await d.from("nc_history").insert([{nc_id:i.id,action:"APERTURA",details:`Hallazgo detectado en obra ${l.project}.`}]),x(),I(!1),c({type:"success",title:"HALLAZGO ABIERTO",message:`No Conformidad ${a} registrada para seguimiento.`})}catch(i){console.error("Create NC Error:",i),c({type:"error",title:"ERROR AL GUARDAR",message:`Detalle técnico: ${i.message||JSON.stringify(i)}`})}},X=async(s,t,a)=>{const{error:l}=await d.from("nc_history").insert([{nc_id:s,action:t,details:a}]);l&&console.error("Error logging history:",l)},Q=async()=>{if(!r||!k.trim())return;const s=r.db_id||r.id;try{const{data:t,error:a}=await d.from("nc_actions").insert([{nc_id:s,description:k.toUpperCase(),responsible:R.toUpperCase(),type:E,due_date:new Date().toISOString().split("T")[0]}]).select().single();if(a)throw a;await X(s,"NUEVA ACCIÓN",`Se asignó acción ${E} a ${R.toUpperCase()}: ${k.toUpperCase()}`),x(),P(""),$(""),c({type:"success",title:"ACCIÓN ASIGNADA",message:"Se ha registrado la nueva acción correctiva."})}catch(t){c({type:"error",title:"ERROR AL AÑADIR ACCIÓN",message:t.message})}},W=async(s,t)=>{try{const{error:a}=await d.from("nc_actions").update({completed:!t}).eq("id",s);if(a)throw a;x()}catch(a){c({type:"error",title:"ERROR AL ACTUALIZAR ACCIÓN",message:a.message})}},f=async s=>{const t=s.db_id||s.id;try{const{error:a}=await d.from("non_conformities").update({title:s.title,process:s.process,project:s.project,severity:s.severity,status:s.status,description:s.description,rca:s.rca,closed_at:s.status==="Cerrada"||s.status==="Eficaz"?new Date().toISOString():null}).eq("id",t);if(a)throw a;x(),A(s)}catch(a){c({type:"error",title:"ERROR AL ACTUALIZAR NC",message:a.message})}},G=async(s,t)=>{if(confirm(`¿Está seguro de eliminar permanentemente el hallazgo ${t}?`))try{const{error:a}=await d.from("non_conformities").delete().eq("id",s);if(a)throw a;x(),c({type:"success",title:"HALLAZGO ELIMINADO",message:`El registro ${t} fue borrado.`})}catch(a){c({type:"error",title:"ERROR AL ELIMINAR",message:a.message})}},Y=async()=>{if(r){M(!0);try{const{analyzeRootCause:s}=await me(async()=>{const{analyzeRootCause:l}=await import("./aiService-DqBcYBBq.js");return{analyzeRootCause:l}},__vite__mapDeps([0,1])),t=await s(r.description||"",`Título: ${r.title}. Proceso: ${r.process}. Obra: ${r.project}`);if(!t)throw new Error("No se pudo generar el análisis. Verifique la API Key.");const a={...r.rca,why1:t.why1||"",why2:t.why2||"",why3:t.why3||"",why4:t.why4||"",why5:t.why5||"",rootCause:t.rootCause||"",aiSuggestedRootCause:t.rootCause};await f({...r,rca:a}),c({type:"success",title:"ANÁLISIS IA COMPLETADO",message:"Metodología 5 Porqués aplicada exitosamente."})}catch(s){console.error("AI Error:",s),c({type:"error",title:"ERROR IA",message:s.message||"Fallo en la conexión con el motor RCA."})}finally{M(!1)}}},ee=async s=>{if(!r||!s.target.files||s.target.files.length===0)return;const t=s.target.files[0],a=new FileReader;a.onloadend=async()=>{const l=a.result,i=r.rca?.evidence_urls||[],v={...r.rca,evidence_urls:[...i,l]};await f({...r,rca:v}),c({type:"success",title:"EVIDENCIA ADJUNTA",message:"Imagen guardada en el expediente."})},a.readAsDataURL(t)},h="w-full p-4 bg-slate-50 dark:bg-[#1a1a24] border border-slate-200 dark:border-white/5 rounded-2xl text-xs font-bold text-slate-800 dark:text-white focus:ring-2 focus:ring-[#5d5fef] outline-none uppercase transition-all placeholder:text-slate-400",u="text-[10px] font-black text-slate-400 dark:text-slate-500 uppercase tracking-widest mb-2 block ml-1";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"animate-fade-in space-y-10 pb-20",children:[e.jsx(ue,{crumbs:[{label:"Sección II: Mejora",path:"/dashboard"},{label:"GESTIÓN DE MEJORA"}]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl md:text-5xl font-black text-slate-800 dark:text-white uppercase tracking-tighter leading-none",children:["Gestión de ",e.jsx("span",{className:"text-rose-600",children:"Mejora"})]}),e.jsxs("p",{className:"text-slate-500 font-bold mt-2 uppercase text-[10px] md:text-xs tracking-widest flex items-center gap-2 italic",children:[e.jsx(te,{className:"text-rose-600"})," Panel de No Conformidades y Análisis RCA Asistido por IA"]})]}),e.jsxs("button",{onClick:()=>I(!0),className:"w-full md:w-auto px-10 py-5 bg-[#5d5fef] text-white rounded-[2rem] font-black text-xs uppercase tracking-widest shadow-xl shadow-[#5d5fef]/20 hover:scale-105 active:scale-95 transition-all flex items-center justify-center gap-3",children:[e.jsx(H,{})," Abrir Nuevo Hallazgo"]})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-4",children:e.jsxs("div",{className:"flex-grow md:flex-initial flex items-center gap-3 px-6 py-4 bg-white dark:bg-alco-surface rounded-[2rem] border border-slate-100 dark:border-white/5 shadow-sm focus-within:ring-2 focus-within:ring-rose-500 transition-all",children:[e.jsx(ae,{className:"text-slate-400"}),e.jsx("input",{type:"text",placeholder:"BUSCAR HALLAZGO, OBRA O PROCESO...",className:"bg-transparent border-none outline-none text-xs font-black uppercase w-full md:w-80 placeholder:text-slate-400",value:b,onChange:s=>J(s.target.value)})]})}),e.jsx("div",{className:"md:hidden space-y-4",children:L?e.jsxs("div",{className:"flex flex-col items-center justify-center p-20 space-y-4",children:[e.jsx(S,{className:"animate-spin text-[#5d5fef] size-10"}),e.jsx("p",{className:"text-xs font-black uppercase tracking-widest text-slate-400 text-center",children:"Sincronizando con el cerebro de InsForge..."})]}):y.length===0?e.jsx("div",{className:"text-center p-12 premium-card",children:e.jsx("p",{className:"text-xs font-black uppercase text-slate-400 tracking-widest",children:"Sin hallazgos activos"})}):y.map(s=>e.jsxs("div",{className:"premium-card p-6 space-y-4 shadow-sm",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"text-[10px] text-[#5d5fef] font-black uppercase tracking-widest bg-[#5d5fef]/10 px-3 py-1 rounded-full",children:s.id}),e.jsx("span",{className:`px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest border ${s.status==="Cerrada"?"bg-emerald-50 text-emerald-700 border-emerald-100":"bg-[#5d5fef]/10 text-[#5d5fef] border-[#5d5fef]/20"}`,children:s.status})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-black text-slate-800 dark:text-slate-100 uppercase text-sm leading-tight tracking-tight",children:s.title}),e.jsxs("p",{className:"text-[10px] text-slate-400 font-bold uppercase mt-1.5 tracking-wider flex items-center gap-1",children:[e.jsx("span",{className:"w-1 h-1 rounded-full bg-[#5d5fef]"})," ",s.process]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-slate-100 dark:border-white/5",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[8px] font-black text-slate-400 uppercase tracking-widest",children:"Severidad"}),e.jsx("span",{className:`text-[10px] font-bold uppercase ${s.severity==="Crítica"?"text-rose-500":s.severity==="Mayor"?"text-amber-500":"text-sky-500"}`,children:s.severity})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{A(s),N(!0)},className:"p-3 bg-slate-100 dark:bg-white/5 text-slate-500 dark:text-slate-400 rounded-2xl hover:text-[#5d5fef] transition-all",children:e.jsx(O,{})}),e.jsx("button",{onClick:()=>G(s.db_id||s.id,s.id),className:"p-3 bg-slate-100 dark:bg-white/5 text-slate-500 dark:text-slate-400 rounded-2xl hover:text-rose-500 transition-all",children:e.jsx(C,{})})]})]})]},s.id))}),e.jsxs("div",{className:"hidden md:block premium-card overflow-hidden animate-fade-in shadow-xl",children:[e.jsx("div",{className:"responsive-table-container",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50/50 dark:bg-white/[0.02] text-[10px] font-black uppercase text-slate-400 tracking-[0.2em] border-b dark:border-white/5",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-10 py-6",children:"ID / Descripción del Hallazgo"}),e.jsx("th",{className:"px-10 py-6",children:"Proceso Origen"}),e.jsx("th",{className:"px-10 py-6 text-center",children:"Estado"}),e.jsx("th",{className:"px-10 py-6 text-right",children:"Gestión"})]})}),e.jsx("tbody",{className:"divide-y dark:divide-white/5",children:L?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-10 py-24 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx(S,{className:"animate-spin text-rose-600"}),e.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:"Consultando registros..."})]})})}):y.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"px-10 py-24 text-center opacity-30 text-xs font-black uppercase tracking-[0.3em]",children:"Sin hallazgos activos en el ciclo de mejora"})}):y.map(s=>e.jsxs("tr",{className:"hover:bg-slate-50 dark:hover:bg-white/5 transition-all group",children:[e.jsxs("td",{className:"px-10 py-8",children:[e.jsx("p",{className:"font-black text-slate-800 dark:text-slate-100 uppercase tracking-tight text-sm",children:s.title}),e.jsxs("div",{className:"flex gap-3 mt-1.5",children:[e.jsx("span",{className:"text-[9px] text-rose-600 font-black uppercase tracking-widest bg-rose-50 dark:bg-rose-900/20 px-2 py-0.5 rounded",children:s.id}),e.jsxs("span",{className:"text-[9px] text-slate-400 font-bold uppercase tracking-widest",children:["Severidad: ",s.severity]})]})]}),e.jsxs("td",{className:"px-10 py-8",children:[e.jsx("p",{className:"text-xs font-bold text-slate-500 uppercase",children:s.process}),e.jsxs("p",{className:"text-[9px] text-slate-400 font-black mt-1 uppercase tracking-tighter italic",children:["OBRA: ",s.project]})]}),e.jsx("td",{className:"px-10 py-8 text-center",children:e.jsx("span",{className:`px-4 py-1.5 rounded-md text-[9px] font-black uppercase tracking-widest border ${s.status==="Cerrada"?"bg-emerald-50 text-emerald-700 border-emerald-100":"bg-sky-50 text-sky-700 border-sky-100"}`,children:s.status})}),e.jsx("td",{className:"px-10 py-8 text-right",children:e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{A(s),N(!0)},className:"p-3 bg-slate-100 dark:bg-white/5 text-slate-500 dark:text-slate-400 rounded-2xl hover:text-[#5d5fef] transition-all shadow-sm border border-slate-200 dark:border-white/5",title:"Analizar Hallazgo",children:e.jsx(O,{})}),e.jsx("button",{onClick:()=>G(s.db_id||s.id,s.id),className:"p-3 bg-slate-100 dark:bg-white/5 text-slate-500 dark:text-slate-400 rounded-2xl hover:text-rose-500 transition-all shadow-sm border border-slate-200 dark:border-white/5",children:e.jsx(C,{})})]})})]},s.id))})]})}),m>1&&e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 py-8 px-10 bg-slate-50/50 dark:bg-white/[0.02] border-t dark:border-white/5",children:[e.jsxs("div",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest",children:["Mostrando ",Math.min(p.length,(o-1)*g+1)," - ",Math.min(p.length,o*g)," de ",p.length," hallazgos"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>w(s=>Math.max(1,s-1)),disabled:o===1,className:`p-3 rounded-xl transition-all ${o===1?"text-slate-300 dark:text-slate-700 cursor-not-allowed":"text-rose-600 hover:bg-rose-50 dark:hover:bg-rose-900/20 active:scale-90"}`,children:e.jsx(re,{className:"scale-75"})}),e.jsx("div",{className:"flex items-center gap-1",children:[...Array(m)].map((s,t)=>{const a=t+1;return a===1||a===m||a>=o-1&&a<=o+1?e.jsx("button",{onClick:()=>w(a),className:`size-10 rounded-xl text-[10px] font-black transition-all ${o===a?"bg-rose-600 text-white shadow-lg shadow-rose-900/20":"text-slate-400 hover:bg-slate-100 dark:hover:bg-white/5"}`,children:a},a):a===o-2||a===o+2?e.jsx("span",{className:"text-slate-300 dark:text-slate-700 font-black",children:"..."},a):null})}),e.jsx("button",{onClick:()=>w(s=>Math.min(m,s+1)),disabled:o===m,className:`p-3 rounded-xl transition-all ${o===m?"text-slate-300 dark:text-slate-700 cursor-not-allowed":"text-rose-600 hover:bg-rose-50 dark:hover:bg-rose-900/20 active:scale-90"}`,children:e.jsx(le,{className:"scale-75"})})]})]})]})]}),V&&r&&e.jsx("div",{className:"fixed inset-0 z-[99999] bg-slate-900/95 backdrop-blur-xl flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-[#0b0b14] rounded-2xl w-[95%] md:w-[90%] lg:w-[85%] xl:max-w-7xl max-h-[90vh] overflow-hidden flex flex-col shadow-2xl border border-slate-200 dark:border-white/5 animate-fade-in-up mx-auto my-auto relative",children:[e.jsxs("div",{className:"p-6 border-b dark:border-white/5 flex justify-between items-center bg-slate-50/50 dark:bg-white/[0.02]",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsx("div",{className:"size-16 bg-rose-600 rounded-[1.5rem] flex items-center justify-center text-white text-3xl shadow-lg shadow-rose-900/30",children:e.jsx(O,{})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-[11px] font-black text-rose-600 uppercase tracking-[0.3em]",children:[r.id," • ANÁLISIS DE MEJORA"]}),e.jsx("h2",{className:"text-3xl font-black text-slate-900 dark:text-white uppercase tracking-tighter leading-none",children:r.title})]})]}),e.jsx("button",{onClick:()=>N(!1),className:"size-12 hover:bg-slate-100 dark:hover:bg-white/5 rounded-full text-slate-400 text-3xl transition-all flex items-center justify-center",children:"×"})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto p-4 md:p-8 grid grid-cols-1 xl:grid-cols-12 gap-8 custom-scrollbar",children:[e.jsxs("div",{className:"xl:col-span-7 space-y-8",children:[e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"flex justify-between items-center rounded-2xl bg-sky-50 dark:bg-white/5 p-2",children:[e.jsxs("h4",{className:"text-sm font-black text-sky-600 dark:text-sky-400 uppercase tracking-[0.2em] flex items-center gap-3 pl-4",children:[e.jsx(_,{})," Análisis Inteligente de Causa Raíz"]}),e.jsxs("button",{onClick:Y,disabled:z,className:"px-6 py-3 bg-white dark:bg-sky-600 text-sky-700 dark:text-white border border-sky-200 dark:border-sky-500 rounded-xl text-[10px] font-black uppercase hover:scale-105 active:scale-95 transition-all flex items-center gap-2 shadow-sm",children:[z?e.jsx(S,{className:"animate-spin"}):e.jsx(ie,{className:"text-yellow-400"})," Generar Dictamen IA"]})]})}),r.rca?.aiSuggestedRootCause&&e.jsxs("div",{className:"p-10 bg-sky-50 dark:bg-sky-900/10 rounded-3xl border border-sky-100 dark:border-sky-800/30 animate-fade-in relative overflow-hidden",children:[e.jsx(_,{className:"absolute -right-5 -bottom-5 text-8xl opacity-5"}),e.jsxs("h4",{className:"text-[11px] font-black text-sky-600 uppercase tracking-[0.3em] mb-6 flex items-center gap-3",children:[e.jsx(_,{})," Dictamen Técnico Estratégico"]}),e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none text-slate-700 dark:text-slate-300 italic font-medium leading-relaxed",children:e.jsx(he,{children:r.rca.aiSuggestedRootCause})})]}),e.jsxs("div",{className:"pt-6 border-t dark:border-white/5 space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h4",{className:"text-sm font-black text-slate-400 uppercase tracking-[0.2em] flex items-center gap-3",children:[e.jsx(ce,{className:"text-slate-500"})," Evidencia y Soportes"]}),e.jsxs("button",{onClick:()=>U.current?.click(),className:"px-4 py-2 bg-slate-100 dark:bg-white/5 text-slate-600 dark:text-slate-300 rounded-lg text-[10px] font-black uppercase hover:bg-slate-200 transition-colors flex items-center gap-2",children:[e.jsx(H,{})," Adjuntar Foto"]}),e.jsx("input",{type:"file",ref:U,className:"hidden",accept:"image/*",capture:"environment",onChange:ee})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[r.rca?.evidence_urls?.map((s,t)=>e.jsxs("div",{className:"aspect-square rounded-xl overflow-hidden border border-slate-200 dark:border-white/10 relative group",children:[e.jsx("img",{src:s,alt:`Evidencia ${t+1}`,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx("button",{onClick:()=>{const a=r.rca?.evidence_urls?.filter((l,i)=>i!==t);f({...r,rca:{...r.rca,evidence_urls:a}})},className:"p-2 bg-white rounded-full text-rose-600 hover:scale-110 transition-transform",children:e.jsx(C,{className:"w-4 h-4"})})})]},t)),(!r.rca?.evidence_urls||r.rca.evidence_urls.length===0)&&e.jsxs("div",{className:"col-span-full py-8 text-center border-2 border-dashed border-slate-200 dark:border-white/5 rounded-2xl",children:[e.jsx("div",{className:"mx-auto size-12 bg-slate-50 dark:bg-white/5 rounded-full flex items-center justify-center text-slate-300 mb-2",children:e.jsx(oe,{})}),e.jsx("p",{className:"text-[10px] text-slate-400 font-bold uppercase",children:"Sin evidencia adjunta"})]})]})]})]}),e.jsxs("div",{className:"xl:col-span-5 space-y-8",children:[e.jsxs("div",{className:"space-y-8",children:[e.jsxs("h4",{className:"text-sm font-black text-slate-400 uppercase tracking-[0.3em] flex items-center gap-3",children:[e.jsx(ne,{className:"text-emerald-500"})," Plan de Acción (CAPA)"]}),e.jsxs("div",{className:"bg-slate-50 dark:bg-white/[0.02] p-8 rounded-[2.5rem] border border-slate-200 dark:border-white/5 space-y-4 shadow-inner",children:[e.jsx("textarea",{className:"w-full p-4 bg-white dark:bg-[#1a1a24] border dark:border-white/5 rounded-2xl text-xs font-bold uppercase outline-none focus:ring-2 focus:ring-emerald-500",rows:2,placeholder:"DESCRIBA ACCIÓN CORRECTIVA...",value:k,onChange:s=>P(s.target.value)}),e.jsx("div",{className:"flex gap-3",children:e.jsxs("div",{className:"flex flex-col flex-grow gap-2",children:[e.jsx("input",{className:"w-full p-4 bg-white dark:bg-[#1a1a24] border dark:border-white/5 rounded-2xl text-[10px] font-black uppercase outline-none",placeholder:"RESPONSABLE...",value:R,onChange:s=>$(s.target.value)}),e.jsxs("select",{className:"w-full p-4 bg-white dark:bg-[#1a1a24] border dark:border-white/5 rounded-2xl text-[10px] font-black uppercase outline-none cursor-pointer",value:E,onChange:s=>Z(s.target.value),children:[e.jsx("option",{value:"Correctiva",children:"ACCIÓN CORRECTIVA"}),e.jsx("option",{value:"Preventiva",children:"ACCIÓN PREVENTIVA"}),e.jsx("option",{value:"Mejora",children:"ACCIÓN DE MEJORA"})]}),e.jsx("button",{onClick:Q,className:"w-full py-4 bg-emerald-600 text-white rounded-2xl font-black text-[10px] uppercase shadow-lg active:scale-95 transition-all",children:"Añadir Acción"})]})})]}),e.jsx("div",{className:"space-y-3",children:r.actions.length===0?e.jsx("p",{className:"text-[10px] text-center text-slate-400 font-black uppercase py-10 border-2 border-dashed dark:border-white/5 rounded-3xl",children:"Sin acciones correctivas registradas"}):r.actions.map(s=>e.jsxs("div",{className:`p-5 rounded-2xl border flex items-center justify-between transition-all ${s.completed?"bg-emerald-50/50 border-emerald-200 opacity-60":"bg-white dark:bg-white/5 border-slate-100 dark:border-white/5"}`,children:[e.jsxs("div",{className:"flex gap-4 items-start",children:[e.jsx("button",{onClick:()=>W(s.id,s.completed),className:`size-6 mt-1 rounded-lg border-2 flex items-center justify-center transition-all ${s.completed?"bg-emerald-600 border-emerald-600 text-white":"border-slate-300 dark:border-slate-700 hover:border-emerald-500"}`,children:s.completed&&e.jsx("i",{className:"fas fa-check text-[10px]"})}),e.jsxs("div",{children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:`text-[8px] font-black uppercase px-2 py-0.5 rounded ${s.type==="Correctiva"?"bg-rose-100 text-rose-700":s.type==="Preventiva"?"bg-amber-100 text-amber-700":"bg-emerald-100 text-emerald-700"}`,children:s.type||"Correctiva"})}),e.jsx("p",{className:`text-xs font-black uppercase leading-tight ${s.completed?"line-through text-slate-400":"text-slate-800 dark:text-white"}`,children:s.description}),e.jsxs("div",{className:"flex gap-3 mt-1",children:[e.jsxs("span",{className:"text-[9px] font-bold text-sky-600 uppercase flex items-center gap-1",children:[e.jsx(de,{className:"scale-75"})," ",s.responsible]}),e.jsxs("span",{className:"text-[9px] font-bold text-slate-400 uppercase flex items-center gap-1",children:[e.jsx(xe,{className:"scale-75"})," VENCE: ",s.dueDate]})]})]})]}),e.jsx("button",{onClick:()=>f({...r,actions:r.actions.filter(t=>t.id!==s.id)}),className:"p-2 text-slate-300 hover:text-rose-500 transition-colors",children:e.jsx(C,{className:"scale-75"})})]},s.id))})]}),e.jsxs("div",{className:"space-y-6 pt-10 border-t dark:border-white/5",children:[e.jsx("label",{className:u,children:"Estado del Hallazgo SGC"}),e.jsxs("select",{className:h,value:r.status,onChange:s=>f({...r,status:s.target.value}),children:[e.jsx("option",{children:"Abierta"}),e.jsx("option",{children:"Bajo Análisis"}),e.jsx("option",{children:"CAPA"}),e.jsx("option",{children:"Cerrada"}),e.jsx("option",{children:"Eficaz"})]}),e.jsxs("button",{onClick:()=>{N(!1),c({type:"success",title:"REGISTRO ACTUALIZADO",message:"Los cambios técnicos han sido salvados."})},className:"w-full py-5 bg-emerald-600 text-white rounded-[2rem] font-black text-xs uppercase tracking-[0.2em] shadow-xl hover:scale-105 active:scale-95 transition-all flex items-center justify-center gap-3",children:[e.jsx(q,{})," Firmar y Guardar Expediente"]}),e.jsxs("div",{className:"pt-10 border-t dark:border-white/5 space-y-6",children:[e.jsxs("h4",{className:"text-sm font-black text-slate-400 uppercase tracking-[0.3em] flex items-center gap-3",children:[e.jsx("i",{className:"fas fa-history text-slate-500"})," Trazabilidad del Hallazgo"]}),e.jsx("div",{className:"space-y-4 max-h-60 overflow-y-auto custom-scrollbar p-2",children:r.history&&r.history.length>0?r.history.slice().reverse().map(s=>e.jsxs("div",{className:"flex gap-4 items-start relative pb-6 border-l-2 border-slate-200 dark:border-white/10 last:border-0 pl-6",children:[e.jsx("div",{className:"absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-slate-200 dark:bg-slate-700 border-4 border-white dark:border-[#0b0b14]"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-[10px] font-black text-slate-400 uppercase",children:[s.date," • ",s.user]}),e.jsx("p",{className:"text-xs font-bold text-slate-700 dark:text-slate-300 mt-1",children:s.action}),e.jsx("p",{className:"text-[10px] text-slate-500 uppercase italic",children:s.details})]})]},s.id)):e.jsx("p",{className:"text-[10px] text-slate-400 italic",children:"No hay historial registrado."})})]})]})]})]})]})}),F&&e.jsx("div",{className:"fixed inset-0 z-[2500] bg-slate-900/90 backdrop-blur-md flex items-center justify-center p-6 overflow-y-auto",children:e.jsxs("div",{className:"bg-white dark:bg-[#0b0b14] rounded-2xl md:rounded-3xl max-w-3xl w-full p-6 md:p-10 shadow-2xl animate-fade-in-up border border-slate-200 dark:border-white/5 relative overflow-hidden my-auto",children:[e.jsxs("div",{className:"flex justify-between items-start mb-10",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-black text-slate-800 dark:text-white uppercase tracking-tighter leading-none",children:["Abrir Nuevo ",e.jsx("span",{className:"text-rose-600",children:"Hallazgo"})]}),e.jsx("p",{className:"text-slate-500 font-bold uppercase text-[10px] tracking-widest mt-2",children:"Detección de Desviación SGC Alco"})]}),e.jsx("button",{onClick:()=>I(!1),className:"text-slate-400 hover:text-rose-500 text-3xl transition-colors",children:"×"})]}),e.jsxs("form",{onSubmit:K,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:u,children:"Título del Hallazgo"}),e.jsx("input",{required:!0,name:"title",className:h,placeholder:"EJ: FALLO EN ADHERENCIA LOTE X"})]}),e.jsxs("div",{children:[e.jsx("label",{className:u,children:"Severidad ISO"}),e.jsxs("select",{name:"severity",className:h,children:[e.jsx("option",{children:"Menor"}),e.jsx("option",{children:"Mayor"}),e.jsx("option",{children:"Crítica"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:u,children:"Proceso de Origen"}),e.jsxs("select",{name:"process",className:h,required:!0,children:[e.jsx("option",{value:"",children:"SELECCIONE..."}),pe.map(s=>e.jsx("option",{children:s},s))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:u,children:"Obra / Proyecto Relacionado"}),e.jsx("input",{name:"project",className:h,placeholder:"EJ: EDIFICIO TORRE A",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:u,children:"Descripción Detallada (Hechos Técnicos)"}),e.jsx("textarea",{required:!0,name:"description",className:`${h} h-32 normal-case font-medium`,placeholder:"Relate los hechos detectados, citando evidencia física o fotográfica..."})]}),e.jsxs("button",{type:"submit",className:"w-full py-5 bg-rose-600 text-white rounded-3xl font-black text-xs uppercase tracking-[0.2em] shadow-xl shadow-rose-900/20 active:scale-95 transition-all",children:[e.jsx(q,{})," Notificar Apertura de NC"]})]})]})})]})};export{we as default};
